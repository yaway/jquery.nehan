/*
 nehan.js
 Copyright (C) 2010 Watanabe Masaki<lambda.watanabe[at]gmail.com>
 http://tb.antiscroll.com/docs/nehan/

 licensed under MIT license.

 Permission is hereby granted, free of charge, to any person
 obtaining a copy of this software and associated documentation
 files (the "Software"), to deal in the Software without
 restriction, including without limitation the rights to use,
 copy, modify, merge, publish, distribute, sublicense, and/or sell
 copies of the Software, and to permit persons to whom the
 Software is furnished to do so, subject to the following
 conditions:

 The above copyright notice and this permission notice shall be
 included in all copies or substantial portions of the Software.

 THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 OTHER DEALINGS IN THE SOFTWARE.
*/

var Nehan;Nehan||(Nehan={}),Nehan.setup=function(a){var b=a||{},c={lang:"ja-JP",debug:!1,kerning:!0,justify:!0,maxRollbackCount:10,minBlockScaleDownRate:65,useVerticalGlyphIfEnable:!0,useStrictWordMetrics:!0,iboxEnable:!1,maxBase:36,lexingBufferLen:2e3},d={root:"document",direction:"vert",hori:"lr-tb",vert:"tb-rl",width:800,height:580,fontSize:16,maxFontSize:64,rubyRate:.5,boldRate:.5,lineRate:2,listMarkerSpacingRate:.4,fontColor:"000000",linkColor:"0000FF",fontImgRoot:"http://nehan.googlecode.com/hg/char-img",vertFontFamily:"'ヒラギノ明朝 Pro W3','Hiragino Mincho Pro','HiraMinProN-W3','IPA明朝','IPA Mincho', 'Meiryo','メイリオ','ＭＳ 明朝','MS Mincho', monospace",horiFontFamily:"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",markerFontFamily:"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",fontSizeAbs:{"xx-large":"33px","x-large":"24px",large:"18px",medium:"16px",small:"13px","x-small":"10px","xx-small":"8px",larger:"1.2em",smaller:"0.8em"},createRootBox:function(a){var b=new xb(a,null,{type:"body"});return b.font=this.getStdFont(),b.flow=this.getStdBoxFlow(),b.lineRate=this.lineRate,b.textAlign="start",b.letterSpacing=0,b},createBox:function(a,b,c){var d=new xb(a,b,c);return d.flow=b.flow,d.lineRate=b.lineRate,d.textAlign=b.textAlign,d.font=new fb(b.font),d.color=b.color,d.letterSpacing=b.letterSpacing,d},getStdPageSize:function(){return new ub(this.width,this.height)},getStdMeasure:function(){var a=this.getStdBoxFlow();return this[a.getPropMeasure()]},getStdBoxFlow:function(){var a=this[this.direction];return ab.getByName(a)},getStdVertFlow:function(){return ab.getByName(this.vert)},getStdHoriFlow:function(){return ab.getByName(this.hori)},getStdFont:function(){var a=new fb(null);return a.family="vert"===this.direction?this.vertFontFamily:this.horiFontFamily,a},getListMarkerSpacingSize:function(a){return a=a||this.fontSize,Math.round(a*this.listMarkerSpacingRate)},getVertBlockDir:function(){return this.vert.split("-")[1]},getHoriIndir:function(){return this.hori.split("-")[0]},getRubyFontSize:function(a){var b=f.rt||null,c=b?b["font-size"]:null;return null===b||null===c?Math.round(this.rubyRate*a):j.getUnitSize(c,a)},getPaletteFontColor:function(a){return a.getValue().toLowerCase()!==this.fontColor.toLowerCase()?a.getPaletteValue():this.fontColor}},e=function(){var a,b,c,d,e=navigator.appName,f=navigator.userAgent.toLowerCase(),g=f.indexOf("trident")>=0&&f.indexOf("msie")<0;if(g)a="msie",d=f.match(/rv:([\.\d]+)/i),b=d?parseInt(d[1],10):"";else{var h=f.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/);h?(d=f.match(/version\/([\.\d]+)/i),d&&(h[2]=d[1]),a=h[1].toLowerCase(),b=parseInt(h[2],10)):(a=e.toLowerCase(),b=parseInt(navigator.appVersion,10))}var i="msie"===a,j=f.indexOf("windows")>=0,k=f.indexOf("macintosh")>=0,l=a.indexOf("chrome")>=0,m=-1!=f.indexOf("iphone"),n=-1!=f.indexOf("ipod"),o=-1!=f.indexOf("ipad"),p=m||n||o,q=-1!=f.indexOf("android"),r=p||q,s=-1!=f.indexOf("webkit"),c=g||!(i&&8>=b),t=l&&(j||k)&&b>=24;return{version:b,isIE:i,isTrident:g,isChrome:l,isWebkit:s,isIphone:m,isIpod:n,isIpad:o,isIphoneFamily:p,isAndroidFamily:q,isSmartPhone:r,isTransformEnable:c,isVerticalGlyphEnable:t}}(),f={a:{display:"inline"},abbr:{display:"inline"},address:{display:"inline","font-style":"italic",section:!0},area:{},article:{display:"block",section:!0},aside:{display:"block",section:!0},audio:{},b:{display:"inline","font-weight":"bold"},base:{},bdi:{display:"inline"},bdo:{display:"inline"},blockquote:{color:"#666666",display:"block","section-root":!0,padding:{start:"1em",end:"1em",before:"0.5em",after:"0.5em"},margin:{after:"1.5em"}},body:{display:"block","section-root":!0},br:{display:"inline",single:!0},button:{display:"inline",interactive:!0},canvas:{display:"inline",embeddable:!0},caption:{display:"block","text-align":"center",margin:{after:"0.5em"}},cite:{display:"inline"},code:{"font-family":"'andale mono', 'lucida console', monospace",display:"inline"},col:{},colgroup:{},command:{},datalist:{},dd:{display:"block",margin:{start:"1em",end:"1em",after:"1.6em"}},del:{color:"#666666",display:"inline"},details:{display:"block","section-root":!0},dfn:{display:"inline","font-style":"italic"},div:{display:"block",embeddable:!0},dl:{display:"block"},dt:{display:"block","font-weight":"bold",margin:{after:"0.2em"}},em:{display:"inline","font-style":"italic"},embed:{},"end-page":{display:"block",single:!0},fieldset:{display:"block","section-root":!0,padding:{start:"1em",end:"0.2em",before:"0.2em",after:"1em"},margin:{after:"1.5em"},"border-width":"1px"},figure:{display:"block","section-root":!0},figcaption:{display:"block","text-align":"center","font-size":"0.8em"},footer:{display:"block",section:!0},font:{display:"inline"},form:{display:"block"},h1:{display:"block","line-rate":1.4,"font-size":"2.4em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"0.5em"}},h2:{display:"block","line-rate":1.4,"font-size":"2.0em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"0.75em"}},h3:{display:"block","line-rate":1.4,"font-size":"1.6em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1em"}},h4:{display:"block","line-rate":1.4,"font-size":"1.4em","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1.25em"}},h5:{display:"block","line-rate":1.4,"font-size":"1.0em","font-weight":"bold","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace",margin:{after:"1.5em"}},h6:{display:"block","line-rate":1.4,"font-weight":"bold","font-family":"'Meiryo','メイリオ','Hiragino Kaku Gothic Pro','ヒラギノ角ゴ Pro W3','Osaka','ＭＳ Ｐゴシック', monospace","font-size":"1.0em"},head:{},header:{display:"block",section:!0},hr:{display:"block","box-sizing":"content-box","border-color":"#b8b8b8","border-style":"solid",single:!0,margin:{after:"1em"},"border-width":{after:"1px"}},"hr.nehan-space":{"border-width":"0px"},html:{display:"block"},i:{display:"inline"},iframe:{display:"block",embeddable:!0},ins:{},img:{display:"inline","box-sizing":"content-box",single:!0},input:{display:"inline",interactive:!0,single:!0},kbd:{display:"inline"},keygen:{},label:{display:"inline"},legend:{display:"block","font-weight":"bold","line-rate":1.5},li:{display:"block",margin:{after:"0.6em"}},"li-mark":{display:"block"},"li-body":{display:"block"},link:{meta:!0,single:!0},main:{display:"block"},map:{},mark:{display:"inline"},menu:{display:"block"},meta:{meta:!0,single:!0},meter:{display:"inline"},nav:{display:"block",section:!0},noscript:{meta:!0},object:{display:"inline",embeddable:!0},ol:{display:"block","list-style-image":"none","list-style-position":"outside","list-style-type":"decimal",margin:{before:"1em"}},optgroup:{},option:{},output:{},p:{display:"block",margin:{after:"1.5em"}},"page-break":{display:"block",single:!0},param:{},pre:{display:"block","white-space":"pre"},progress:{display:"inline"},q:{display:"block"},rb:{display:"inline"},rp:{display:"inline"},ruby:{display:"inline"},rt:{"font-size":"0.5em","line-rate":1,display:"inline"},s:{display:"inline"},samp:{display:"inline"},script:{display:"inline",meta:!0},section:{display:"block",section:!0},select:{},small:{display:"inline","font-size":"0.8em"},source:{},span:{display:"inline"},strong:{display:"inline","font-weight":"bold"},style:{display:"inline",meta:!0},sub:{display:"inine"},summary:{display:"inline"},sup:{display:"inine"},table:{display:"block",embeddable:!0,"table-layout":"fixed","background-color":"white","border-collapse":"collapse","border-color":"#a8a8a8","border-style":"solid","border-width":"1px",margin:{start:"0.5em",end:"0.5em",after:"1.6em"}},tbody:{display:"block"},td:{display:"block","section-root":!0,"border-width":"1px","border-color":"#a8a8a8","border-style":"solid",padding:{start:"0.8em",end:"0.8em",before:"0.5em",after:"0.5em"}},textarea:{display:"inline",embeddable:!0,interactive:!0},tfoot:{display:"block","border-color":"#a8a8a8","border-style":"solid","font-style":"italic"},th:{display:"block","line-rate":1.4,"border-width":"1px","border-color":"#a8a8a8","border-style":"solid",padding:{start:"0.8em",end:"0.8em",before:"0.5em",after:"0.5em"}},thead:{display:"block","font-weight":"bold","background-color":"#c3d9ff","border-color":"#a8a8a8","border-style":"solid"},time:{display:"inline"},title:{meta:!0},tr:{display:"block","border-color":"#a8a8a8","border-style":"solid"},track:{},u:{display:"inline"},ul:{display:"block","list-style-image":"none","list-style-type":"disc","list-style-position":"outside",margin:{before:"1em"}},"var":{display:"inline"},video:{display:"inline",embeddable:!0},wbr:{display:"inline",single:!0},"?xml":{single:!0},"!doctype":{single:!0},".nehan-rounded":{padding:["1.6em","1.0em","1.6em","1.0em"],"border-radius":"10px"},".nehan-xx-large":{"font-size":d.fontSizeAbs["xx-large"]},".nehan-x-large":{"font-size":d.fontSizeAbs["x-large"]},".nehan-large":{"font-size":d.fontSizeAbs.large},".nehan-medium":{"font-size":d.fontSizeAbs.medium},".nehan-small":{"font-size":d.fontSizeAbs.small},".nehan-x-small":{"font-size":d.fontSizeAbs["x-small"]},".nehan-xx-small":{"font-size":d.fontSizeAbs["xx-small"]},".nehan-larger":{"font-size":d.fontSizeAbs.larger},".nehan-smaller":{"font-size":d.fontSizeAbs.smaller},".nehan-disp-block":{display:"block"},".nehan-disp-inline":{display:"inline"},".nehan-disp-inline-block":{display:"inline-block"},".nehan-ta-start":{"text-align":"start"},".nehan-ta-center":{"text-align":"center"},".nehan-ta-end":{"text-align":"end"},".nehan-float-start":{"float":"start"},".nehan-float-end":{"float":"end"},".nehan-flow-lr-tb":{flow:"lr-tb"},".nehan-flow-tb-rl":{flow:"tb-rl"},".nehan-flow-tb-lr":{flow:"tb-lr"},".nehan-flow-rl-tb":{flow:"rl-tb"},".nehan-flow-flip":{flow:"flip"},".nehan-lsp-inside":{"list-style-position":"inside"},".nehan-lsp-outside":{"list-style-position":"outside"},".nehan-lst-none":{"list-style-type":"none"},".nehan-lst-decimal":{"list-style-type":"decimal"},".nehan-lst-disc":{"list-style-type":"disc"},".nehan-lst-circle":{"list-style-type":"circle"},".nehan-lst-square":{"list-style-type":"square"},".nehan-lst-decimal-leading-zero":{"list-style-type":"decimal-leading-zero"},".nehan-lst-lower-alpha":{"list-style-type":"lower-alpha"},".nehan-lst-upper-alpha":{"list-style-type":"upper-alpha"},".nehan-lst-lower-latin":{"list-style-type":"lower-latin"},".nehan-lst-upper-latin":{"list-style-type":"upper-latin"},".nehan-lst-lower-roman":{"list-style-type":"lower-roman"},".nehan-lst-upper-roman":{"list-style-type":"upper-roman"},".nehan-lst-lower-greek":{"list-style-type":"lower-greek"},".nehan-lst-upper-greek":{"list-style-type":"upper-greek"},".nehan-lst-cjk-ideographic":{"list-style-type":"cjk-ideographic"},".nehan-lst-hiragana":{"list-style-type":"hiragana"},".nehan-lst-hiragana-iroha":{"list-style-type":"hiragana-iroha"},".nehan-lst-katakana":{"list-style-type":"katakana"},".nehan-lst-katakana-iroha":{"list-style-type":"katakana-iroha"},".nehan-tcy":{"text-combine":"horizontal"},".nehan-text-combine":{"text-combine":"horizontal"},".nehan-empha-dot-filled":{"text-emphasis-style":"filled dot"},".nehan-empha-dot-open":{"text-emphasis-style":"open dot"},".nehan-empha-circle-filled":{"text-emphasis-style":"filled circle"},".nehan-empha-circle-open":{"text-emphasis-style":"open circle"},".nehan-empha-double-circle-filled":{"text-emphasis-style":"filled double-circle"},".nehan-empha-double-circle-open":{"text-emphasis-style":"open double-circle"},".nehan-empha-triangle-filled":{"text-emphasis-style":"filled triangle"},".nehan-empha-triangle-open":{"text-emphasis-style":"open triangle"},".nehan-empha-sesame-filled":{"text-emphasis-style":"filled sesame"},".nehan-empha-sesame-open":{"text-emphasis-style":"open sesame"},".nehan-drop-caps::first-letter":{display:"block",width:"4em",height:"4em","float":"start","line-rate":1,"font-size":"4em"},".nehan-line-no-ruby":{"line-rate":1},".nehan-gap-start":{margin:{start:"1em"}},".nehan-gap-end":{margin:{end:"1em"}},".nehan-gap-after":{margin:{after:"1em"}},".nehan-gap-before":{margin:{before:"1em"}}},g={};g.extend=function(a,b){function c(){}c.prototype=b.prototype,a.superClass_=b.prototype,a.prototype=new c,a.prototype.constructor=a};var h={iter:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c])},iteri:function(a,b){for(var c=0,d=a.length;d>c;c++)b(c,a[c])},reviter:function(a,b){for(var c=a.length;c>=0;c--)b(a[c])},reviteri:function(a,b){for(var c=a.length;c>=0;c--)b(c,a[c])},forall:function(a,b){for(var c=0,d=a.length;d>c;c++)if(!b(a[c]))return!1;return!0},map:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b(a[d]);return c},mapi:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)c[d]=b(d,a[d]);return c},fold:function(a,b,c){for(var d=b,e=0,f=a.length;f>e;e++)d=c(d,a[e]);return d},filter:function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)b(a[d])&&c.push(a[d]);return c},find:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(b(e))return e}return null},revfind:function(a,b){for(var c=a.length-1;c>=0;c--){var d=a[c];if(b(d))return d}return null},indexOf:function(a,b){for(var c=0,d=a.length;d>c;c++){var e=a[c];if(b(e))return c}return-1},exists:function(a,b){for(var c=0,d=a.length;d>c;c++)if(b(a[c]))return!0;return!1},mem:function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]==b)return!0;return!1},sum:function(a){return this.fold(a,0,function(a,b){return a+b})},minobj:function(a,b){var c=null,d=null;return this.iter(a,function(a){var e=b(a);(null===d||d>e)&&(c=a,d=e)}),c},maxobj:function(a,b){var c=null,d=null;return this.iter(a,function(a){var e=b(a);(null===d||e>d)&&(c=a,d=e)}),c},refcopy:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b[c]=a[c];return b},count:function(a,b){for(var c=0,d=0,e=a.length;e>d;d++)b(a[d])&&c++;return c},create:function(a,b){var c=new Array(a);if("undefined"!=typeof b)for(var d=0;a>d;d++)c[d]=b;return c},first:function(a){return a[0]||null},last:function(a){var b=a.length;return 0===b?null:a[b-1]},zip:function(a,b){for(var c=[],d=0,e=Math.min(a.length,b.length);e>d;d++)c[d]=[a[d],b[d]];return c},reverse:function(a){return a.reverse(),a}},i={isEmpty:function(a){for(var b in a)return!1;return!0},map:function(a,b){var c={};for(var d in a)c[d]=b(a[d]);return c},each:function(a,b){for(var c in a)b(c,a[c])},iter:function(a,b){for(var c in a)b(a,c,a[c])}},j={getFontSize:function(a,b){var c=String(a).replace(/\/.+$/,""),e=d.fontSizeAbs[c]||c;return this.getUnitSize(e,b)},getUnitSize:function(a,b){var c=String(a);if(c.indexOf("rem")>0){var e=parseFloat(c.replace("rem",""));return Math.round(d.fontSize*e)}if(c.indexOf("em")>0){var f=parseFloat(c.replace("em",""));return Math.round(b*f)}if(c.indexOf("pt")>0)return Math.round(4*parseInt(c,10)/3);if(c.indexOf("%")>0)return Math.round(b*parseInt(c,10)/100);var g=parseInt(c,10);return isNaN(g)?0:g},getBoxSize:function(a,b,c){var d="string"==typeof a?a:String(a);if(d.indexOf("%")>0){var e=Math.round(c*parseInt(d,10)/100);return Math.min(c,e)}return this.getUnitSize(a,b)},getCornerSize:function(a,b){var c={};for(var d in a)c[d]=[0,0],c[d][0]=this.getUnitSize(a[d][0],b),c[d][1]=this.getUnitSize(a[d][1],b);return c},getEdgeSize:function(a,b){var c={};for(var d in a)c[d]=this.getUnitSize(a[d],b);return c}},k={trimHeadCRLF:function(a){return a.replace(/^\n+/,"")},trimFootCRLF:function(a){return a.replace(/\n+$/,"")},trimCRLF:function(a){return this.trimFootCRLF(this.trimHeadCRLF(a))},trim:function(a){return a.replace(/^\s+/,"").replace(/\s+$/,"")},cutQuote:function(a){return a.replace(/['\"]/g,"")},capitalize:function(a){return""===a?"":a.charAt(0).toUpperCase()+a.slice(1)},log:function(a,b){var c=b||10;return Math.log(a)/Math.log(c)},filenameConcat:function(a,b){return a=""===a?"":"/"===a.slice(-1)?a:a+"/",b=""===b?"":"/"===b[0]?b.substring(1,b.length):b,a+b},getCamelName:function(a){var b=this;return h.mapi(a.split("-"),function(a,c){return 0===a?c:b.capitalize(c)}).join("")}},l={convBase:function(a,b){if(0===a)return[0];for(var c=[],d=a;d>0;)c.unshift(d%b),d=Math.floor(d/b);return c}},m=function(){var a=1e3/60;return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(b,c){var d="undefined"==typeof c?a:c;window.setTimeout(b,d)}}(),n={cssVenderPrefixes:["-moz","-webkit","-o","-ms"],cssCorders:["top-left","top-right","bottom-left","bottom-right"],cssBorderRadius:["border-top-left-radius","border-top-right-radius","border-bottom-left-radius","border-bottom-right-radius"],cssBoxDirs:["top","right","bottom","left"],cssBoxDirsLogical:["before","end","after","start"],cssBoxCornersLogical:["start-before","end-before","end-after","start-after"],css2dIndex:{1:[0,0],2:[0,1]},css4dIndex:{1:[0,0,0,0],2:[0,1,0,1],3:[0,1,2,1],4:[0,1,2,3]},space:"&nbsp;",clearFix:"<div style='clear:both'></div>"},o={toString:function(a){var b=[];for(var c in a)b.push(c+":"+a[c]);return b.join(";")},addNehanPrefix:function(a){return"nehan-"+a},addNehanHeaderPrefix:function(a){return"nehan-header-"+a},addNehanTocLinkPrefix:function(a){return"nehan-toc-link-"+a}},p={escape:function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;")},attr:function(a){var b=[];for(var c in a)a[c]&&b.push(c+"='"+this.escape(a[c]+"")+"'");return b==[]?"":b.join(" ")},tagWrap:function(a,b,c){return[this.tagStart(a,c||{}),b,this.tagEnd(a)].join("")},tagSingle:function(a,b){return"<"+a+" "+this.attr(b)+"/>"},tagStart:function(a,b){return"<"+a+" "+this.attr(b)+">"},tagEnd:function(a){return"</"+a+">"}},q={id:function(){return function(a){return a}},eq:function(a){return function(b){return a==b}},neq:function(a){return function(b){return a!=b}}},r={copy:function(a,b){for(var c in b)a[c]=b[c];return a},merge:function(a,b,c){for(var d in b)a[d]="undefined"==typeof c[d]?b[d]:c[d];return a}},s={PAGE_BREAK:1,LINE_BREAK:2,BUFFER_END:3,SINGLE_RETRY:4,IGNORE:5,FORCE_TERMINATE:6,toString:function(a){for(var b in this)if(this[b]===a)return b;return"??"}},t=function(){var a=function(a){return k.trim(String(a)).replace(/;/g,"").replace(/\n/g,"")},b=function(a){return a.indexOf(" ")<0?[a]:a.split(/\s+/)},c=function(a){return a.indexOf("/")<0?[a]:a.split("/")},d=function(a,b){var c={};if(a.length!==b.length)throw"invalid args:zip_obj";return h.iteri(a,function(a,d){c[d]=b[a]}),c},e=function(a){return n.css2dIndex[Math.min(a,2)]||[]},f=function(a){return n.css4dIndex[Math.min(a,4)]||[]},g=function(a,b){return h.map(b,function(b){return a[b]})},i=function(a){var b=e(a.length);return g(a,b)},j=function(a){var b=f(a.length);return g(a,b)},l=function(a){var b=n.cssBoxDirsLogical,c=j(a);return d(b,c)},m=function(a){var b=n.cssBoxCornersLogical,c=j(a);return d(b,c)},o=function(a){return l(b(a))},p=function(a){var d=i(c(a)),e=h.map(d,function(a){return j(b(a))}),f=h.zip(e[0],e[1]);return m(f)},q=function(a){var c=[],d=b(a),e=d.length;return e>=1&&c.push({"border-width":o(d[0])}),e>=2&&c.push({"border-style":o(d[1])}),e>=3&&c.push({"border-color":o(d[2])}),c},r=function(a){var c=[],d=b(a),e=d.length;return e>=1&&c.push({"list-style-type":o(d[0])}),e>=2&&c.push({"list-style-image":o(d[1])}),e>=3&&c.push({"list-style-position":o(d[2])}),c},s=function(){return{}},t=function(){return{}},u=function(a){var c=b(a),d=c.length;return 1===d?{inline:{pos:c[0],offset:0},block:{pos:"center",offset:0}}:d>=2&&4>d?{inline:{pos:c[0],offset:0},block:{pos:c[1],offset:0}}:d>=4?{inline:{pos:c[0],offset:c[1]},block:{pos:c[2],offset:c[3]}}:null},v=function(a){var c=b(a),d=c.length;return 1===d?{inline:c[0],block:c[0]}:d>=2?{inline:c[0],block:c[1]}:null},w=function(b,c){switch(typeof c){case"function":case"object":case"boolean":return c}switch(c=a(c),b){case"background":return t(c);case"background-position":return u(c);case"background-repeat":return v(c);case"border":return q(c);case"border-color":return o(c);case"border-radius":return p(c);case"border-style":return o(c);case"border-width":return o(c);case"font":return s(c);case"list-style":return r(c);case"margin":return o(c);case"padding":return o(c);default:return c}};return{format:function(a,b){try{return w(a,b)}catch(c){return{}}}}}(),u=function(){function a(a){this.expr=this._normalize(a),this.left=this.op=this.right=null,this._parseExpr(this.expr)}var b=/[^=^~|$*\s]+/,c=["|=","~=","^=","$=","*=","="];return a.prototype={_normalize:function(a){return a.replace(/\[/g,"").replace(/\]/g,"")},_parseSymbol:function(a){var c=a.match(b);return c?c[0]:""},_parseOp:function(a){return h.find(c,function(b){return a.indexOf(b)>=0})},_parseExpr:function(a){this.left=this._parseSymbol(a),this.left&&(a=k.trim(a.slice(this.left.length))),this.op=this._parseOp(a),this.op&&(a=k.trim(a.slice(this.op.length)),this.right=k.cutQuote(k.trim(a)))},_testHasAttr:function(a){return null!==a.getTagAttr(this.left)},_testEqual:function(a){var b=a.getTagAttr(this.left);return b===this.right},_testCaretEqual:function(a){var b=a.getTagAttr(this.left),c=new RegExp("^"+this.right);return c.test(b)},_testDollarEqual:function(a){var b=a.getTagAttr(this.left),c=new RegExp(this.right+"$");return c.test(b)},_testTildeEqual:function(a){var b=a.getTagAttr(this.left).split(/\s+/);return h.exists(b,q.eq(this.right))},_testPipeEqual:function(a){var b=a.getTagAttr(this.left);return b==this.right||b.indexOf(this.right+"-")>=0},_testStarEqual:function(a){var b=a.getTagAttr(this.left);return b.indexOf(this.right)>=0},_testOp:function(a){switch(this.op){case"=":return this._testEqual(a);case"^=":return this._testCaretEqual(a);case"$=":return this._testDollarEqual(a);case"|=":return this._testPipeEqual(a);case"~=":return this._testTildeEqual(a);case"*=":return this._testStarEqual(a)}throw"undefined operation:"+this.op},test:function(a){return this.op&&this.left&&this.right?this._testOp(a):this.left?this._testHasAttr(a):!1}},a}(),v=function(){function a(a){this.name=this._normalize(a)}return a.prototype={isPseudoElement:function(){return"before"===this.name||"after"===this.name||"first-letter"===this.name||"first-line"===this.name},test:function(a){switch(this.name){case"before":return!0;case"after":return!0;case"first-letter":return!a.isEmpty();case"first-line":return!a.isEmpty();case"first-child":return a.isFirstChild();case"last-child":return a.isLastChild();case"first-of-type":return a.isFirstOfType();case"last-of-type":return a.isLastOfType();case"only-child":return a.isOnlyChild();case"only-of-type":return a.isOnlyOfType();case"empty":return a.isEmpty();case"root":return a.isRoot()}return!1},_normalize:function(a){return a.replace(/:+/g,"")}},a}(),w=function(){function a(a){this.name=a.name,this.id=a.id,this.className=a.className,this.attrs=a.attrs,this.pseudo=a.pseudo}return a.prototype={test:function(a){return null===a?!1:this.name&&"*"!=this.name&&a.getName()!=this.name?!1:this.className&&!a.hasClass(this.className)?!1:this.id&&a.getTagAttr("id")!=this.id?!1:this.attrs.length>0&&!this._testAttrs(a)?!1:this.pseudo&&!this.pseudo.test(a)?!1:!0},getIdSpec:function(){return this.id?1:0},getClassSpec:function(){return this.className?1:0},getTypeSpec:function(){return"*"!==this.name&&""!==this.name?1:0},getPseudoClassSpec:function(){return this.pseudo?this.pseudo.isPseudoElement()?0:1:0},getAttrSpec:function(){return this.attrs.length},_testAttrs:function(a){return h.forall(this.attrs,function(b){return b.test(a)})}},a}(),x={findDescendant:function(a,b){for(a=a.getParent();null!==a;){if(b.test(a))return a;a=a.getParent()}return null},findChild:function(a,b){return a=a.getParent(),null===a?null:b.test(a)?a:null},findAdjSibling:function(a,b,c){var d=a.getParentChilds();return h.find(d,function(a){var d=a.getNext();return d&&c.test(a)&&b.test(d)})},findGenSibling:function(a,b,c){var d=a.getParentChilds(),e=h.find(d,function(a){return c.test(a)});if(null===e)return null;for(a=e.getNext();null!==a;){if(b.test(a))return e;a=a.getNext()}return null}},y=function(){function a(a){this.buff=this._normalize(a)}var b=/^[\w-_\.#\*!\?]+/,c=/^\[[^\]]+\]/,d=/^:{1,2}[\w-_]+/;return a.prototype={getTokens:function(){for(var a=[],b=function(b){a.push(b)};""!==this.buff;){var c=this._getNextToken();if(null===c)break;b(c)}return a},_getNextToken:function(){if(""===this.buff)return null;var a=this.buff.charAt(0);switch(a){case"+":case"~":case">":return this._stepBuff(1),a;default:var b=this._getType();if(b){var c=this._getAttrs(),d=this._getPseudo();return this._parseType(b,c,d)}}throw"invalid selector:"+this.buff},_normalize:function(a){return k.trim(a).replace(/\s+/g," ")},_stepBuff:function(a){this.buff=k.trim(this.buff.slice(a))},_parseType:function(a,b,c){return new w({name:this._getName(a),id:this._getId(a),className:this._getClassName(a),attrs:b,pseudo:c?new v(c):null})},_getByRex:function(a){var b=null,c=this.buff.match(a);return c&&(b=c[0],this._stepBuff(b.length)),b},_getName:function(a){return a.replace(/[\.#].+$/,"")},_getId:function(a){var b=a.split("#");return b.length>0?b[1]:""},_getClassName:function(a){var b=a.split(".");return b.length>=2?b[1]:""},_getType:function(){return this._getByRex(b)},_getAttrs:function(){for(var a=[],b=function(b){a.push(b)};;){var d=this._getByRex(c);if(!d)break;b(new u(d))}return a},_getPseudo:function(){return this._getByRex(d)}},a}(),z={accept:function(a,b){if(0===a.length)throw"selector syntax error:"+src;for(var c,d,e,f,g=a.length-1,h=function(){return 0>g?null:a[g--]},i=function(){g++};g>=0;){if(c=h(),c instanceof w==!1)throw"selector syntax error:"+src;if(!c.test(b))return!1;if(d=h(),null===d)return!0;if(d instanceof w)e=d,f=" ";else if("string"==typeof d&&(f=d,e=h(),null===e||e instanceof w==!1))throw"selector syntax error:"+src;switch(f){case" ":b=x.findDescendant(b,e);break;case">":b=x.findChild(b,e);break;case"+":b=x.findAdjSibling(b,c,e);break;case"~":b=x.findGenSibling(b,c,e);break;default:throw"selector syntax error:invalid combinator("+f+")"}if(null===b)return!1;i()}return!0}},A=function(){function a(a,b){this.key=this._normalizeKey(a),this.value=this._formatValue(b),this.tokens=this._getSelectorTokens(this.key),this.spec=this._countSpec(this.tokens)}var b=function(a,b,d){d instanceof Array?c(a,d):a[b]=d},c=function(a,c){h.iter(c,function(c){for(var d in c)b(a,d,c[d])})};return a.prototype={getKey:function(){return this.key},getValue:function(){return this.value},setValue:function(a){this.value=a},getSpec:function(){return this.spec},test:function(a){return z.accept(this.tokens,a)},isPseudoElement:function(){return this.key.indexOf("::")>=0},hasPseudoElement:function(a){return this.key.indexOf("::"+a)>=0},_countSpec:function(a){var b=0,c=0,d=0;return h.iter(a,function(a){a instanceof w&&(b+=a.getIdSpec(),c+=a.getClassSpec()+a.getPseudoClassSpec()+a.getAttrSpec(),d+=a.getTypeSpec())}),parseInt([b,c,d].join(""),10)},_getSelectorTokens:function(a){var b=new y(a);return b.getTokens()},_normalizeKey:function(a){return k.trim(a).toLowerCase().replace(/\s+/g," ")},_formatValue:function(a){var c={};for(var d in a)b(c,d,t.format(d,a[d]));return c}},a}(),B=function(){var a=[],b=[],c=function(){a.sort(function(a,b){return a.spec-b.spec})},d=function(){b.sort(function(a,b){return a.spec-b.spec})},e=function(c,d){var e=f[c];r.copy(e,d);var g=h.find(a.concat(b),function(a){return a.getKey()===c});g&&g.setValue(e)},g=function(c,d){var e=new A(c,d);return e.isPseudoElement()?b.push(e):a.push(e),e},j=function(b){return h.fold(a,{},function(a,c){return!c.isPseudoElement()&&c.test(b)?r.copy(a,c.getValue()):a})},k=function(a,c){return h.fold(b,{},function(b,d){return d.hasPseudoElement(c)&&d.test(a)?r.copy(b,d.getValue()):b})},l=function(){i.iter(f,function(a,b,c){g(b,c)}),c(),d()};return l(),{setValue:function(a,b){if(f[a])return void e(a,b);var h=g(a,b);return f[a]=h.getValue(),h.isPseudoElement()?void d():void c()},getValuePe:function(a,b){return k(a,b)},getValue:function(a){return j(a)}}}(),C=function(){var a=function(a,b){for(var c=function(){return a.charAt(0)},d=function(b){a=a.substring(b)},e=function(b){var c=-1;return h.iter(b,function(b){var d=a.indexOf(b,1);(0>c||c>d)&&(c=d)}),(c>=0?a.substring(0,c):a).toLowerCase()},f=function(b){var c=a.indexOf(b,1);return c>=1?a.substring(1,c):a},g=function(g){if(""===a)return void(g&&(b[g]=!0));var h,i=c();if(" "===i)d(1),arguments.callee(g);else if("="===i){if(d(1),a.length>0){var j=c();'"'===j||"'"===j?(h=f(j),d(h.length+2)):(h=e([" "]),d(h.length)),b[g]=h}}else g?b[g]=!0:(g=e([" ","="]),d(g.length),arguments.callee(g))};""!==a;)g();return b},b=function(a){return a.replace(/<[\S]+/,"").replace(/^\s+/,"").replace("/>","").replace(">","").replace(/\s+$/,"").replace(/\n/g,"").replace(/[　|\s]+/g," ").replace(/\s+=/g,"=").replace(/=\s+/g,"=")};return{parse:function(c){return c=b(c),a(c,{})}}}(),D=function(){function a(a,c){this._type="tag",this._inherited=!1,this._gtid=b++,this.src=a,this.parent=null,this.next=null,this.contentRaw=c||"",this.name=this._parseName(this.src),this.tagAttr=C.parse(this.src),this.id=this.tagAttr.id||"",this.classes=this._parseClasses(this.tagAttr["class"]||""),this.dataset={},this.datasetRaw={},this.childs=[],this.cssAttrStatic=this._getSelectorValue(),this.cssAttrDynamic={},this.tagAttr.style&&this._parseInlineStyle(this.tagAttr.style||""),this._parseDataset()}var b=0,c=/(^(<[^>]+>|[\s\n])*)(\S)/im,e=function(a){return h.exists(["padding","margin","border"],function(b){return a.indexOf(b)>=0})};return a.prototype={inherit:function(a,b){if(this._inherited||!this.hasLayout())return this;return this.parent=a,this.parent&&this.parent.addChild(this),this.cssAttrStatic=this._getSelectorValue(),this.applyCallbacks(b),this._inherited=!0,this},applyCallbacks:function(a){var b,c=this.getCssAttr("onload");c&&(b=c(this,a),b&&this.setCssAttrs(b));var d=this.getCssAttr("nth-child");d&&(b=d(this.getChildNth(),this,a),b&&this.setCssAttrs(b));var e=this.getCssAttr("nth-of-type");e&&(b=e(this.getChildOfTypeNth(),this,cotext),b&&this.setCssAttrs(b))},setContentRaw:function(a){this.contentRaw=a},setTagAttr:function(a,b){this.tagAttr[a]=b},setCssAttr:function(a,b){this.cssAttrDynamic[a]=b},setCssAttrs:function(a){for(var b in a)this.setCssAttr(b,a[b])},setNext:function(a){this.next=a},addChild:function(a){this.childs.length>0&&h.last(this.childs).setNext(a),this.childs.push(a)},addClass:function(a){this.classes.push(a)},removeClass:function(a){this.classes=h.filter(this.classes,function(b){return b!=a})},iterTagAttr:function(a){i.each(this.tagAttr,a)},iterCssAttrDynamic:function(a){i.each(this.cssAttrDynamic,a)},iterCssAttrStatic:function(a){i.each(this.cssAttrStatic,a)},iterCssAttr:function(a){this.iterCssAttrStatic(a),this.iterCssAttrDynamic(a)},iterAttr:function(a){this.iterCssAttr(a),this.iterTagAttr(a)},getName:function(){return this.name},getAttr:function(a,b){var c=this.getTagAttr(a);return"undefined"!=typeof c&&null!==c?c:(c=this.getCssAttr(a),"undefined"!=typeof c&&null!==c?c:"undefined"!=typeof b?b:null)},getParent:function(){return this.parent||null},getChilds:function(){return this.childs},getNext:function(){return this.next||null},getDisplay:function(){return this.getCssAttr("display","block")},getWhiteSpace:function(){return this.getCssAttr("white-space","normal")},getParentChilds:function(){return this.parent?this.parent.getChilds():[]},getParentTypeChilds:function(){var a=this.getName();return h.filter(this.getParentChilds(),function(b){return b.getName()===a})},getCssClasses:function(){return this.classes.join(" ")},getTagAttr:function(a,b){var c=this.tagAttr[a];return"undefined"!=typeof c?c:"undefined"!=typeof b?b:null},getCssAttr:function(a,b){var c=this.cssAttrDynamic[a];return"undefined"!=typeof c?c:(c=this.cssAttrStatic[a],"undefined"!=typeof c?c:"undefined"!=typeof b?b:null)},getDataset:function(a,b){var c=this.dataset[a];return"undefined"!=typeof c?c:"undefined"!=typeof b?b:null
},getDatasetAttrs:function(){return this.dataset},getDatasetAttrsRaw:function(){return this.datasetRaw},getContentRaw:function(){return this.contentRaw},getContent:function(){var a=this._getPseudoBefore(),b=this._getPseudoAfter();return this._setPseudoFirst([a,this.contentRaw,b].join(""))},getSrc:function(){return this.src},getWrapSrc:function(){return this.isSingleTag()?this.src:this.src+this.contentRaw+"</"+this.name+">"},getLogicalFloat:function(){return this.getCssAttr("float","none")},getHeaderRank:function(){return this.getName().match(/h([1-6])/)?parseInt(RegExp.$1,10):0},getStaticSize:function(a,b){var c=this.getAttr("width"),e=this.getAttr("height");if(c&&e)return c=j.getBoxSize(c,a,b),e=j.getBoxSize(e,a,b),new ub(c,e);if("img"===this.name){var f=d.fontSize;return new ub(f,f)}return null},hasStaticSize:function(){return null!==this.getAttr("width")&&null!==this.getAttr("height")},hasFlow:function(){return null!==this.getCssAttr("flow")},hasClass:function(a){return h.exists(this.classes,q.eq(a))},hasLayout:function(){var a=this.getName();return"br"!=a&&"page-break"!=a&&"end-page"!=a},isPseudoElement:function(){return"before"===this.name||"after"===this.name||"first-letter"===this.name||"first-line"===this.name},isFloated:function(){return"none"!=this.getLogicalFloat()},isPush:function(){return"undefined"!=typeof this.tagAttr.push},isPull:function(){return"undefined"!=typeof this.tagAttr.pull},isAnchorTag:function(){return"a"===this.name&&null!==this.getTagAttr("name")},isAnchorLinkTag:function(){var a=this.getTagAttr("href");return"a"===this.name&&a&&a.indexOf("#")>=0},isBlock:function(){var a=this.getDisplay();return"block"===a?!0:this.hasStaticSize()&&this.isFloated()&&"inline-block"!==a?!0:this.isPush()||this.isPull()?!0:!1},isInline:function(){var a=this.getDisplay();return"inline"===a||"inline-block"===a},isInlineBlock:function(){return"inline-block"===this.getDisplay()},isSingleTag:function(){return this.getCssAttr("single")===!0},isTcyTag:function(){return"horizontal"===this.getCssAttr("text-combine","")},isSectionRootTag:function(){return this.getCssAttr("section-root")===!0},isSectionTag:function(){return this.getCssAttr("section")===!0},isBoldTag:function(){var a=this.getName();return"b"===a||"strong"===a},isHeaderTag:function(){return this.getHeaderRank()>0},isPageBreakTag:function(){var a=this.getName();return"end-page"===a||"page-break"===a},isMetaTag:function(){return this.getCssAttr("meta")===!0},isSameTag:function(a){return this._gtid===a._gtid},getChildIndexFrom:function(a){var b=this;return h.indexOf(a,function(a){return b.isSameTag(a)})},getChildNth:function(){return this.getChildIndexFrom(this.getParentChilds())},getLastChildNth:function(){return this.getChildIndexFrom(h.reverse(this.getParentChilds()))},getChildOfTypeNth:function(){return this.getChildIndexFrom(this.getParentTypeChilds())},getLastChildOfTypeNth:function(){return this.getChildIndexFrom(this.getParentTypeChilds())},isFirstChild:function(){return 0===this.getChildNth()},isLastChild:function(){var a=this.getParentChilds();return this.getChildNth()===a.length-1},isFirstOfType:function(){return 0===this.getChildOfTypeNth()},isLastOfType:function(){var a=this.getParentTypeChilds();return this.getChildOfTypeNth()===a.length-1},isOnlyChild:function(){return 1===this.getParentChilds().length},isOnlyOfType:function(){var a=this.getParentTypeChilds();return 1===a.length&&this.isSame(a[0])},isRoot:function(){return null===this.parent},isEmpty:function(){return""===this.contentRaw},_getSelectorValue:function(){return this.isPseudoElement()?B.getValuePe(this.parent,this.getName()):B.getValue(this)},_parseName:function(a){return a.replace(/</g,"").replace(/\/?>/g,"").split(/\s/)[0].toLowerCase()},_parseId:function(){var a=this.tagAttr.id||"";return""===a?a:0===this.tagAttr.id.indexOf("nehan-")?"nehan-"+a:a},_parseClasses:function(a){a=k.trim(a.replace(/\s+/g," "));var b=""===a?[]:a.split(/\s+/);return h.map(b,function(a){return 0===a.indexOf("nehan-")?a:"nehan-"+a})},_parseCssClasses:function(a){return h.map(a,function(a){return"."+a})},_setPseudoFirst:function(a){var b=B.getValuePe(this,"first-letter");a=i.isEmpty(b)?a:this._setPseudoFirstLetter(a);var c=B.getValuePe(this,"first-line");return i.isEmpty(c)?a:this._setPseudoFirstLine(a)},_setPseudoFirstLetter:function(a){return a.replace(c,function(a,b,c,d){return b+p.tagWrap("first-letter",d)})},_setPseudoFirstLine:function(a){return p.tagWrap("first-line",a)},_getPseudoBefore:function(){var a=B.getValuePe(this,"before");return i.isEmpty(a)?"":p.tagWrap("before",a.content||"")},_getPseudoAfter:function(){var a=B.getValuePe(this,"after");return i.isEmpty(a)?"":p.tagWrap("after",a.content||"")},_parseInlineStyle:function(a){var b=this.cssAttrDynamic,c=a.indexOf(";")>=0?a.split(";"):[a];h.iter(c,function(a){var c=a.split(":");if(c.length>=2){var d=k.trim(c[0]).toLowerCase();if(!e(d)){var f=k.trim(c[1]);b[d]=f}}})},_parseDataset:function(){for(var a in this.tagAttr)if(0===a.indexOf("data-")){var b=this._parseDatasetName(a),c=this.tagAttr[a];this.dataset[b]=c,this.datasetRaw[a]=c}},_parseDatasetName:function(a){var b=a.slice(5);return k.getCamelName(b)}},a}(),E={isTag:function(a){return"tag"===a._type},isText:function(a){return"char"===a._type||"word"===a._type||"tcy"===a._type},isChar:function(a){return"char"===a._type},isWord:function(a){return"word"===a._type},isTcy:function(a){return"tcy"===a._type},isInline:function(a){return this.isText(a)?!0:a.isBlock()?!1:a.isInline()||a.isInlineBlock()}},F=function(){function a(a,b){this.data=a,this._type="char",this.isRef=b||!1,this.isRef||this._setup(a.charCodeAt(0))}var b=["。","."],f=["、",","],g=["｢","「","『","【","［","（","《","〈","≪","＜","｛","{","[","("],i=["」","｣","』","】","］","）","》","〉","≫","＞","｝","}","]",")"],j=["ぁ","ぃ","ぅ","ぇ","ぉ","っ","ゃ","ゅ","ょ","ゎ","ァ","ィ","ゥ","ェ","ォ","ヵ","ヶ","ッ","ャ","ュ","ョ","ヮ"],k=["）","\\",")","」","】","〕","］","\\","]","。","』","＞","〉","》","、","．","\\",".",",","”","〟"],l=["（","\\","(","「","【","［","〔","\\","[","『","＜","〈","《","“","〝"];return a.prototype={getCssPadding:function(a){var b=new lb;return this.paddingStart&&b.setStart(a.flow,this.paddingStart),this.paddingEnd&&b.setEnd(a.flow,this.paddingEnd),b.getCss()},getCssVertGlyph:function(a){var b={},c=this.isPaddingEnable();return b["font-family"]=a.getFontFamily(),b["margin-left"]="auto",b["margin-right"]="auto",this.isKakkoStart()?c||(b["margin-top"]="-0.5em"):(this.getVertScale()<1&&(b.height="0.5em"),c&&(b["margin-bottom"]="0.5em")),b},getCssVertImgChar:function(a){var b={},c=a.getFontSize();return b.display="block",b.width=c+"px",b.height=this.getVertHeight(c)+"px",b["margin-left"]="auto",b["margin-right"]="auto",this.isPaddingEnable()&&r.copy(b,this.getCssPadding(a)),b},getCssVertRotateCharIE:function(a){var b={},c=a.getFontSize();return b["float"]="left",b["writing-mode"]="tb-rl",b["padding-left"]=Math.round(c/2)+"px",b["line-height"]=c+"px",b},getCssVertEmphaSrc:function(){var a={};return a},getCssVertEmphaText:function(a){var b={},c=a.getFontSize();return b.display="inline-block",b.width=c+"px",b.height=c+"px",b},getCssHoriEmphaSrc:function(){var a={};return a},getCssHoriEmphaText:function(){var a={};return a},getCssVertLetterSpacing:function(a){var b={};return b["margin-bottom"]=a.letterSpacing+"px",b},getCssVertHalfSpaceChar:function(a){var b={},c=a.getFontSize(),d=Math.round(c/2);return b.height=d+"px",b["line-height"]=d+"px",b},getCssVertSmallKana:function(){var a={};return a.position="relative",a.top="-0.1em",a.right="-0.12em",a.height=this.bodySize+"px",a["line-height"]=this.bodySize+"px",a},getHoriScale:function(){return this.hscale?this.hscale:1},getVertScale:function(){return this.vscale?this.vscale:1},getVertHeight:function(a){var b=this.getVertScale();return 1===b?a:Math.round(a*b)},hasMetrics:function(){return"undefined"!=typeof this.bodySize},getAdvance:function(a,b){return this.bodySize+this.getPaddingSize()+b},getPaddingSize:function(){return(this.paddingStart||0)+(this.paddingEnd||0)},getCharCount:function(){return" "===this.data||"	"===this.data||"　"===this.data?0:1},setMetrics:function(a,b){var c=a.isTextVertical(),d=c?this.getVertScale():this.getHoriScale();this.bodySize=1!=d?Math.round(b.size*d):b.size,this.spaceRateStart&&(this.paddingStart=Math.round(this.spaceRateStart*b.size)),this.spaceRateEnd&&(this.paddingEnd=Math.round(this.spaceRateEnd*b.size)),this.img&&"tenten"===this.img&&(this.bodySize=b.size),c||this.isRef||!this.isHankaku()||(this.bodySize=Math.round(b.size/2))},_setImg:function(a,b,c){this.img=a,this.vscale=b||1,this.hscale=c||this.vscale},_setCnv:function(a,b,c){this.cnv=a,this.vscale=b||1,this.hscale=c||this.vscale},_setRotate:function(a){this.rotate=a},_setup:function(a){switch(a){case 32:this._setCnv("&nbsp;",.5,.5);break;case 12300:this._setImg("kakko1",.5);break;case 65378:this._setImg("kakko1",.5);break;case 12301:this._setImg("kakko2",.5);break;case 65379:this._setImg("kakko2",.5);break;case 12302:this._setImg("kakko3",.5);break;case 12303:this._setImg("kakko4",.5);break;case 65288:this._setImg("kakko5",.5);break;case 40:this._setImg("kakko5",.5);break;case 65371:this._setImg("kakko5",.5);break;case 123:this._setImg("kakko5",.5);break;case 65289:this._setImg("kakko6",.5);break;case 41:this._setImg("kakko6",.5);break;case 65373:this._setImg("kakko6",.5);break;case 125:this._setImg("kakko6",.5);break;case 65308:this._setImg("kakko7",.5);break;case 60:this._setImg("kakko7",.5);break;case 12296:this._setImg("kakko7",.5);break;case 65310:this._setImg("kakko8",.5);break;case 62:this._setImg("kakko8",.5);break;case 12297:this._setImg("kakko8",.5);break;case 12298:this._setImg("kakko9",.5);break;case 8810:this._setImg("kakko9",.5);break;case 12299:this._setImg("kakko10",.5);break;case 8811:this._setImg("kakko10",.5);break;case 65339:this._setImg("kakko11",.5);break;case 12308:this._setImg("kakko11",.5);break;case 91:this._setImg("kakko11",.5);break;case 65341:this._setImg("kakko12",.5);break;case 12309:this._setImg("kakko12",.5);break;case 93:this._setImg("kakko12",.5);break;case 12304:this._setImg("kakko17",.5);break;case 12305:this._setImg("kakko18",.5);break;case 65306:this._setImg("tenten",.5,1);break;case 58:this._setImg("tenten",.5,1);break;case 12290:this._setImg("kuten",.5);break;case 65377:this._setImg("kuten",.5);break;case 65294:this._setImg("period",1);break;case 46:this._setImg("period",1);break;case 12289:this._setImg("touten",.5);break;case 65380:this._setImg("touten",.5);break;case 44:this._setImg("touten",.5);break;case 65292:this._setImg("touten",.5);break;case 65374:this._setImg("kara",1);break;case 12316:this._setImg("kara",1);break;case 8230:this._setImg("mmm",1);break;case 8229:this._setImg("mm",1);break;case 12317:this._setImg("dmn1",1);break;case 12319:this._setImg("dmn2",1);break;case 65309:this._setImg("equal",1);break;case 61:this._setImg("equal",1);break;case 12540:this._setImg("onbiki",1);break;case 45:this._setCnv("&#65372;");break;case 8213:this._setCnv("&#65372;");break;case 65293:this._setCnv("&#65372;");break;case 9472:this._setCnv("&#65372;");break;case 8593:this._setCnv("&#8594;");break;case 8594:this._setCnv("&#8595;");break;case 8658:this._setCnv("&#8595;");break;case 8595:this._setCnv("&#8592;");break;case 8592:this._setCnv("&#8593;");break;case 8220:this._setRotate(90);break;case 8221:this._setRotate(90)}},isNewLineChar:function(){return"\n"===this.data},isImgChar:function(){return"undefined"!=typeof this.img},isCnvChar:function(){return"undefined"!=typeof this.cnv},isRotateChar:function(){return"undefined"!=typeof this.rotate},isCharRef:function(){return this.isRef},isHalfSpaceChar:function(){return this.isCnvChar()&&"&nbsp;"===this.cnv},isKerningChar:function(){return this.isKutenTouten()||this.isKakko()},getImgSrc:function(a){return[d.fontImgRoot,this.img,a+".png"].join("/")},isPaddingEnable:function(){return"undefined"!=typeof this.paddingStart||"undefined"!=typeof this.paddingEnd},isVertGlyphEnable:function(){return!this.isTenten()&&c.useVerticalGlyphIfEnable&&e.isVerticalGlyphEnable},isTenten:function(){return this.img&&"tenten"===this.img},isHeadNg:function(){return h.mem(k,this.data)},isTailNg:function(){return h.mem(l,this.data)},isSmallKana:function(){return h.mem(j,this.data)},isKakkoStart:function(){return h.mem(g,this.data)},isKakkoEnd:function(){return h.mem(i,this.data)},isKakko:function(){return this.isKakkoStart()||this.isKakkoEnd()},isKuten:function(){return h.mem(b,this.data)},isTouten:function(){return h.mem(f,this.data)},isKutenTouten:function(){return this.isKuten()||this.isTouten()},isZenkaku:function(){return"u"===escape(this.data).charAt(1)},isHankaku:function(){return!this.isZenkaku(this.data)}},a}(),G=function(){function a(a,b){this.data=a,this._type="word",this._devided=b||!1}return a.prototype={getCssVertTrans:function(a){var b={};return b["letter-spacing"]=a.letterSpacing+"px",b.width=a.getFontSize()+"px",b.height=this.bodySize+"px",b["margin-left"]="auto",b["margin-right"]="auto",b},getCssVertTransBody:function(a){var b={};return b["font-family"]=a.getFontFamily(),b},getCssVertTransBodyTrident:function(a){var b={};b["font-family"]=a.getFontFamily(),b.width=a.getFontSize()+"px",b.height=this.bodySize+"px",b["transform-origin"]="50% 50%",b["line-height"]=this.bodySize+"px";var c=Math.floor((this.bodySize-a.getFontSize())/2);return c>0&&(b.transform="rotate(90deg) translate(-"+c+"px, 0)"),b},getCssVertTransIE:function(a){var b={},c=a.getFontSize();return b["float"]="left",b["writing-mode"]="tb-rl",b["letter-spacing"]=a.letterSpacing+"px",b["padding-left"]=Math.round(c/2)+"px",b["line-height"]=c+"px",b},getCharCount:function(){return 1},getAdvance:function(a,b){return this.bodySize+b*this.getLetterCount()},hasMetrics:function(){return"undefined"!=typeof this.bodySize},countUpper:function(){for(var a=0,b=0;b<this.data.length;b++)/[A-Z]/.test(this.data.charAt(b))&&a++;return a},setMetrics:function(a,b){return c.useStrictWordMetrics&&O.isEnable()?void(this.bodySize=O.getMeasure(b,this.data)):(this.bodySize=Math.round(this.data.length*b.size*.5),void(b.isBold()&&(this.bodySize+=Math.round(d.boldRate*this.bodySize))))},getLetterCount:function(){return this.data.length},setDevided:function(a){this._devided=a},isDevided:function(){return this._devided},cutMeasure:function(b,c){var d=Math.round(b/2),e=Math.round(this.bodySize/d),f=Math.round(c/d);if(f>=e)return this;var g=this.data.substring(0,f),h=new a(g,!0);return this.data=this.data.slice(f),this.setDevided(!0),h}},a}(),H=function(){function a(a){this.data=a,this._type="tcy"}return a.prototype={getCharCount:function(){return 1},getAdvance:function(a,b){return this.bodySize+b},hasMetrics:function(){return"undefined"!=typeof this.bodySize},setMetrics:function(a,b){this.bodySize=b.size}},a}(),I=function(){function a(a,b){this._type="ruby",this.rbs=a,this.rt=b,this.padding=new lb}return a.prototype={hasMetrics:function(){return"undefined"!=typeof this.advanceSize},getCharCount:function(){return this.rbs?this.rbs.length:0},getAdvance:function(){return this.advanceSize},getExtent:function(a){return 3*this.rubyFontSize+a},getRbs:function(){return this.rbs},getRtString:function(){return this.rt?this.rt.getContent():""},getRtFontSize:function(){return this.rubyFontSize},getCssVertRuby:function(a){var b={},c=a.getFontSize();return b["margin-left"]=Math.round((a.maxExtent-c)/2)+"px",b[a.flow.getPropExtent()]=this.getExtent(c)+"px",b[a.flow.getPropMeasure()]=this.getAdvance()+"px",b},getCssHoriRuby:function(){var a={};return a.display="inline-block",a},getCssVertRt:function(){var a={};return a["float"]="left",a},getCssHoriRt:function(){var a={};return a["line-height"]=Math.round(1.5*this.getRtFontSize())+"px",a["font-size"]=this.getRtFontSize()+"px",a["vertical-align"]="bottom",a},getCssVertRb:function(){var a={};return a["float"]="left",r.copy(a,this.padding.getCss()),a},getCssHoriRb:function(){var a={};return r.copy(a,this.padding.getCss()),a["text-align"]="center",a},setMetrics:function(a,b,c){this.rubyFontSize=d.getRubyFontSize(b.size);var e=h.fold(this.rbs,0,function(d,e){return e.setMetrics(a,b),d+e.getAdvance(a,c)}),f=this.rubyFontSize*this.getRtString().length;if(this.advanceSize=e,f>e){var g=Math.ceil((f-e)/2);this.rbs.length>0&&(this.padding.setStart(a,g),this.padding.setEnd(a,g)),this.advanceSize+=g+g}}},a}(),J=function(){function a(a){this.value=String(a),this.red=parseInt(this.value.substring(0,2),16),this.green=parseInt(this.value.substring(2,4),16),this.blue=parseInt(this.value.substring(4,6),16)}return a.prototype={getRed:function(){return this.red},getGreen:function(){return this.green},getBlue:function(){return this.blue},getColorValue:function(){return this.value}},a}(),K=function(){function a(a){this.setValue(a)}return a.prototype={setValue:function(a){this.value=L.get(a)},getValue:function(){return this.value},getCssValue:function(){return"transparent"===this.value?this.value:"#"+this.value},getRgb:function(){return new J(this.value)},getCss:function(){var a={};return a.color=this.getCssValue(),a}},a}(),L=function(){var a={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4","indianred ":"cd5c5c","indigo ":"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32",transparent:"transparent"},b=/^(?:[0-9a-f]{3}){1,2}$/;return{get:function(c){return c=c.replace(/#/g,"").toLowerCase(),b.test(c)?3===c.length?c[0]+c[0]+c[1]+c[1]+c[2]+c[2]:c:a[c]||c}}}(),M=function(){var a=[0,36,73,109,146,182,219,255],b=[0,85,170,255],c=function(a){var b=a.toString(16);return b.length<=1?"0"+b:b},d=function(a,b){return h.exists(b,q.eq(a))?a:h.minobj(b,function(b){return Math.abs(b-a)})};return{getColor:function(e){var f=d(e.getRed(),a),g=d(e.getGreen(),a),h=d(e.getBlue(),b);return[c(f),c(g),c(h)].join("")}}}(),N=function(){var a={"lower-alpha":["a","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],"upper-alpha":["A","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],"lower-roman":["i","i","ii","iii","iv","v","vi","vii","viii","ix","x","xi","xii","xiii","xiv","xv","xvi","xvii","xviii","xix","xx"],"upper-roman":["I","I","II","III","IV","V","VI","VII","VIII","IX","X","XI","XII","XIII","XIV","XV","XVI","XVII","XVIII","XIX","XX"],"lower-greek":["α","α","β","γ","δ","ε","ζ","η","θ","ι","κ","λ","μ","ν","ξ","ο","π","ρ","σ","τ","υ","φ","χ","ψ","ω"],"upper-greek":["Α","Α","Β","Γ","Δ","Ε","Ζ","Η","Θ","Ι","Κ","Λ","Μ","Ν","Ξ","Ο","Π","Ρ","Σ","Τ","Υ","Φ","Χ","Ψ","Ω"],"cjk-ideographic":["〇","一","二","三","四","五","六","七","八","九","十"],hiragana:["あ","あ","い","う","え","お","か","き","く","け","こ","さ","し","す","せ","そ","た","ち","つ","て","と","な","に","ぬ","ね","の","は","ひ","ふ","へ","ほ","ま","み","む","め","も","や","ゆ","よ","ら","り","る","れ","ろ","わ","ゐ","ゑ","を","ん"],"hiragana-iroha":["い","い","ろ","は","に","ほ","へ","と","ち","り","ぬ","る","を","わ","か","よ","た","れ","そ","つ","ね","な","ら","む","う","ゐ","の","お","く","や","ま","け","ふ","こ","え","て","あ","さ","き","ゆ","め","み","し","ゑ","ひ","も","せ","す"],katakana:["ア","ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト","ナ","ニ","ヌ","ネ","ノ","ハ","ヒ","フ","ヘ","ホ","マ","ミ","ム","メ","モ","ヤ","ユ","ヨ","ラ","リ","ル","レ","ロ","ワ","ヰ","ヱ","ヲ","ン"],"katakana-iroha":["イ","イ","ロ","ハ","ニ","ホ","ヘ","ト","チ","リ","ヌ","ル","ヲ","ワ","カ","ヨ","タ","レ","ソ","ツ","ネ","ナ","ラ","ム","ウ","ヰ","ノ","オ","ク","ヤ","マ","ケ","フ","コ","エ","テ","ア","サ","キ","ユ","メ","ミ","シ","ヱ","ヒ","モ","セ","ス"]},b={"upper-latin":"upper-alpha","lower-latin":"lower-alpha"};return{getTableByName:function(c){return a[b[c]||c]},getBaseByName:function(a){var b=this.getTableByName(a);return b.length},getStringByName:function(a,b){for(var c=this.getTableByName(a),d=c.length,e=l.convBase(b,d),f="",g=0;g<e.length;g++){var h=e[g],i=0===g?e[g]:Math.min(h+1,d-1);f+=c[i]||""}return f}}}(),O=function(){var a=document.createElement("canvas");a.style.width=Math.max(d.width,d.height)+"px",a.style.height=d.maxFontSize+"px";var b;return a.getContext&&(b=a.getContext("2d"),b.textAlign="left"),{isEnable:function(){return b&&"undefined"!=typeof b.measureText},getMetrics:function(a,c){return b.font=a.toString(),b.measureText(c)},getMeasure:function(a,b){var c=this.getMetrics(a,b);return c.width}}}(),P=function(){function a(a){this.type=a}var b={disc:"&#x2022;",circle:"&#x25CB;",square:"&#x25A0;"};return a.prototype={isDecimalList:function(){return"decimal"===this.type||"decimal-leading-zero"===this.type},isNoneList:function(){return"none"===this.type},isMarkList:function(){return"disc"===this.type||"circle"===this.type||"square"===this.type},isCountableList:function(){return!this.isNoneList()&&!this.isMarkList()},isHankaku:function(){return"lower-alpha"===this.type||"upper-alpha"===this.type||"lower-roman"===this.type||"upper-roman"===this.type||this.isDecimalList()},isZenkaku:function(){return!this.isHankaku()},_getMarkerDigitString:function(a){return"decimal"===this.type?a.toString(10):"decimal-leading-zero"===this.type?10>a?"0"+a.toString(10):a.toString(10):N.getStringByName(this.type,a)},getMarkerHtml:function(a){var b=this.getMarkerText(a);return this.isZenkaku()?p.tagWrap("span",b,{"class":"nehan-tcy"}):b},getMarkerText:function(a){if(this.isNoneList())return n.space;if(this.isMarkList())return b[this.type]||"";var c=this._getMarkerDigitString(a);return c+"."},getMarkerAdvance:function(a,b,c){var e=Math.round(b/2),f=e,g=d.getListMarkerSpacingSize(b),h=this.isZenkaku()?b:e,i=this.getMarkerText(c);return this.isNoneList()?b:this.isMarkList()?b+g:this.isZenkaku()&&a.isTextVertical()?b+g:(i.length-1)*h+f+g}},a}(),Q=function(){function a(a){this.pos=a}return a.prototype={isOutside:function(){return"outside"===this.pos},isInside:function(){return"inside"===this.pos}},a}(),R=function(){function a(a){this.image=a}return a.prototype={getMarkerAdvance:function(a,b){var c=this.image[a.getPropMeasure()]||b,e=d.getListMarkerSpacingSize(b);return c+e},getMarkerHtml:function(){var a=this.image.url,b=this.image.width||d.fontSize,c=this.image.height||d.fontSize;return p.tagSingle("img",{src:a,"class":"nehan-list-image",width:b,height:c})}},a}(),S=function(){function a(a){this.type=new P(a.type||"none"),this.position=new Q(a.position||"outside"),this.image="none"!==a.image?new R(a.image):null,this.format=a.format||null}return a.prototype={isMultiCol:function(){return this.position.isOutside()},isInside:function(){return this.position.isInside()},isImageList:function(){return null!==this.image},getMarkerHtml:function(a){return null!==this.format?"function"==typeof this.format?this.format(a):this.format:null!==this.image?this.image.getMarkerHtml(a):this.type.getMarkerHtml(a)},getMarkerAdvance:function(a,b,c){return this.image?this.image.getMarkerAdvance(a,b):this.type.getMarkerAdvance(a,b,c)}},a}(),T=function(){function a(a){this.dir=a}return a.prototype={init:function(a){this.dir=a},isValid:function(){return"lr"===this.dir||"rl"===this.dir||"tb"===this.dir},isHorizontal:function(){return"lr"===this.dir||"rl"===this.dir},isVertical:function(){return"tb"===this.dir},isLeftToRight:function(){return"lr"===this.dir},isRightToLeft:function(){return"rl"===this.dir},reverse:function(){switch(this.dir){case"lr":return"rl";case"rl":return"lr";case"tb":return"tb";default:return""}}},a}(),U=function(){function a(a,b){T.call(this,a),this.multicol=b||!1}return g.extend(a,T),a.prototype.flip=function(){switch(this.dir){case"lr":case"rl":return"tb";case"tb":return d.getVertBlockdir();default:return""}},a.prototype.getCss=function(){var a={};return this.isHorizontal()?a["float"]="lr"===this.dir?"left":"right":this.isVertical()&&this.multicol&&(a["float"]="lr"===d.getHoriIndir()?"left":"right"),a},a.prototype.getPropBefore=function(){switch(this.dir){case"lr":return"left";case"rl":return"right";case"tb":return"top";default:return""}},a.prototype.getPropAfter=function(){switch(this.dir){case"lr":return"right";case"rl":return"left";case"tb":return"bottom";default:return""}},a}(),V=function(){function a(a){T.call(this,a)}return g.extend(a,T),a.prototype.getPropStart=function(){switch(this.dir){case"lr":return"left";case"rl":return"right";case"tb":return"top";default:return""}},a.prototype.getPropEnd=function(){switch(this.dir){case"lr":return"right";case"rl":return"left";case"tb":return"bottom";default:return""}},a}(),W=function(){function a(a,b){this.pos=a||"center",this.offset=b||0}return a.prototype={getCssValue:function(a){var b=[a.getProp(this.pos)];return this.offset&&b.push(this.offset),b.join(" ")}},a}(),X=function(){function a(a,b){this.inline=a,this.block=b}return a.prototype={getCssValue:function(a){return[this.inline.getCssValue(a),this.block.getCssValue(a)].join(" ")},getCss:function(a){var b={};return b["background-pos"]=this.getCssValue(a),b}},a}(),Y=function(){function a(a){this.value=a}return a.prototype={isSingleValue:function(){return"repeat-x"===this.value||"repeat-y"===this.value||"repeat-inline"===this.value||"repeat-block"===this.value},getCssValue:function(a){var b=a.isTextVertical();switch(this.value){case"repeat-inline":case"repeat-x":return b?"repeat-y":"repeat-x";case"repeat-block":case"repeat-y":return b?"repeat-x":"repeat-y";default:return this.value}}},a}(),Z=function(){function a(a,b){this.inline=a,this.block=b}return a.prototype={_getRepeatValue:function(a,b){var c=a.isTextVertical();switch(b){case"repeat-inline":case"repeat-x":return c?"repeat-y":"repeat-x";case"repeat-block":case"repeat-y":return c?"repeat-x":"repeat-y";default:return b}},getCssValue:function(a){var b=[this.inline];return this.inline.isSingleValue()||b.push(this.block),h.map(b,function(b){return b.getCssValue(a)}).join(" ")}},a}(),$=function(){function a(){}return a.prototype={getCss:function(a){var b={};return this.pos&&r.copy(b,this.pos.getCss(a)),this.repeat&&(b["background-repeat"]=this.repeat.getCssValue(a)),this.origin&&(b["background-origin"]=this.origin),this.color&&(b["background-color"]=this.color),this.image&&(b["background-image"]=this.image),this.attachment&&(b["background-attachment"]=this.attachment),b}},a}(),_=function(){function a(a,b,c){this.inflow=new V(a),this.blockflow=new U(b,c)}return a.prototype={getCss:function(){var a={};return r.copy(a,this.blockflow.getCss()),a},getName:function(){return[this.inflow.dir,this.blockflow.dir].join("-")},isValid:function(){return this.inflow.isValid()&&this.blockflow.isValid()},isTextLineFirst:function(){return this.isTextVertical()&&this.blockflow.isLeftToRight()?!0:!1},isBlockflowVertical:function(){return this.blockflow.isVertical()},isTextVertical:function(){return this.inflow.isVertical()},isTextHorizontal:function(){return this.inflow.isHorizontal()},getTextHorizontalDir:function(){return this.isTextHorizontal()?this.inflow.dir:""},getProp:function(a){switch(a){case"start":return this.getPropStart();case"end":return this.getPropEnd();case"before":return this.getPropBefore();case"after":return this.getPropAfter()}},getPropStart:function(){return this.inflow.getPropStart()},getPropEnd:function(){return this.inflow.getPropEnd()},getPropBefore:function(){return this.blockflow.getPropBefore()},getPropAfter:function(){return this.blockflow.getPropAfter()},getPropExtent:function(){return this.isTextVertical()?"width":"height"},getPropMeasure:function(){return this.isTextVertical()?"height":"width"},getPropWidth:function(){return this.isTextVertical()?"extent":"measure"},getPropHeight:function(){return this.isTextVertical()?"measure":"extent"},getParallelFlipFlow:function(){return ab.get(this.inflow.dir,this.blockflow.dir,!1)},getParallelFlow:function(){return ab.get(this.inflow.dir,this.blockflow.dir,!0)},getFlipFlow:function(){return this.isTextVertical()?d.getStdHoriFlow():d.getStdVertFlow()},getFloatedWrapFlow:function(){return this.isTextVertical()?this:this.getParallelFlow()},getBoxSize:function(a,b){var c=new ub(0,0);return c[this.getPropMeasure()]=a,c[this.getPropExtent()]=b,c}},a}(),ab={"tb-rl":new _("tb","rl"),"tb-lr":new _("tb","lr"),"lr-tb":new _("lr","tb"),"rl-tb":new _("rl","tb"),"tb-rl-mc":new _("tb","rl",!0),"tb-lr-mc":new _("tb","lr",!0),"lr-tb-mc":new _("lr","tb",!0),"rl-tb-mc":new _("rl","tb",!0),NORMAL:new _("lr","tb"),get:function(a,b,c){var d=c||!1,e=a+"-"+b+(d?"-mc":"");return this.getByName(e)},getByName:function(a){if("undefined"==typeof this[a])throw"undefined box-flow"+a;return this[a]}},bb={iter:function(a,b){h.iter(n.cssBoxDirs,function(c){a[c]&&b(c,a[c])})},map:function(a,b){return a instanceof Array?h.map(a,b):"object"==typeof a?i.map(a,b):b(a)},setValue:function(a,b,c){return"undefined"!=typeof c.start&&this.setStart(a,b,c.start),"undefined"!=typeof c.end&&this.setEnd(a,b,c.end),"undefined"!=typeof c.before&&this.setBefore(a,b,c.before),"undefined"!=typeof c.after&&this.setAfter(a,b,c.after),a},setBefore:function(a,b,c){a[b.getPropBefore()]=c},setAfter:function(a,b,c){a[b.getPropAfter()]=c},setStart:function(a,b,c){a[b.getPropStart()]=c},setEnd:function(a,b,c){a[b.getPropEnd()]=c}},cb={sortCornerDirection:function(a,b){var c={top:0,bottom:1,left:2,right:3};return[a,b].sort(function(a,b){return c[a]-c[b]})},getCornerName:function(a,b){var c=this.sortCornerDirection(a,b);return[c[0],k.capitalize(c[1])].join("")}},db=function(){function a(a){this.value=a||"margin-box"}return a.prototype={containEdgeSize:function(){return"margin-box"!==this.value},containMarginSize:function(){return"margin-box"===this.value},containBorderSize:function(){return"margin-box"===this.value||"border-box"===this.value},containPaddingSize:function(){return"margin-box"===this.value||"border-box"===this.value||"padding-box"===this.value
},getSubEdge:function(a){var b=new tb;return this.containMarginSize()&&(b.margin=a.margin),this.containPaddingSize()&&(b.padding=a.padding),this.containBorderSize()&&(b.border=a.border),b},getCss:function(){var a={};return a["box-sizing"]="content-box",a}},a}(),eb={"content-box":new db("content-box"),"padding-box":new db("padding-box"),"border-box":new db("border-box"),"margin-box":new db("margin-box"),getByName:function(a){if("undefined"==typeof this[a])throw"undefined box-sizing:"+a;return this[a]}},fb=function(){function a(a){r.merge(this,{weight:"normal",style:"normal",size:d.fontSize,family:"monospace"},a||{}),this.parent=a||null}return a.prototype={isBold:function(){return this.weight&&"normal"!==this.weight&&"lighter"!==this.weight},toString:function(){return[this.weight,this.style,this.size+"px",this.family].join(" ")},getCss:function(){var a={},b=null===this.parent;return(b||this.weight!=this.parent.weight)&&(a["font-weight"]=this.weight),(b||this.style!=this.parent.style)&&(a["font-style"]=this.style),(b||this.size!=this.parent.size)&&(a["font-size"]=this.size+"px"),(b||this.family!=this.parent.family)&&(a["font-family"]=this.family),a}},a}(),gb=function(){function a(a){this._type=a,this.top=0,this.right=0,this.bottom=0,this.left=0}return a.prototype={clear:function(){this.top=0,this.right=0,this.bottom=0,this.left=0},isEnable:function(){return 0!==this.top||0!==this.right||0!==this.bottom||0!==this.left},getDirProp:function(a){return[this._type,a].join("-")},getCss:function(){var a={},b=this;return h.iter(["top","right","bottom","left"],function(c){var d=b[c];d>0&&(a[b.getDirProp(c)]=b[c]+"px")}),a},getWidth:function(){return this.left+this.right},getHeight:function(){return this.top+this.bottom},getMeasureSize:function(a){return a.isTextVertical()?this.getHeight():this.getWidth()},getExtentSize:function(a){return a.isBlockflowVertical()?this.getHeight():this.getWidth()},setSize:function(a,b){bb.setValue(this,a,b)},setStart:function(a,b){this[a.getPropStart()]=b},setEnd:function(a,b){this[a.getPropEnd()]=b},setBefore:function(a,b){this[a.getPropBefore()]=b},setAfter:function(a,b){this[a.getPropAfter()]=b},getStart:function(a){return this[a.getPropStart()]},getEnd:function(a){return this[a.getPropEnd()]},getBefore:function(a){return this[a.getPropBefore()]},getAfter:function(a){return this[a.getPropAfter()]}},a}(),hb=function(){function a(){this.hori=0,this.vert=0}return a.prototype={setSize:function(a){this.hori=a[0],this.vert=a[1]},getCssValueHori:function(){return this.hori+"px"},getCssValueVert:function(){return this.vert+"px"}},a}(),ib=function(){function a(){this.topLeft=new hb,this.topRight=new hb,this.bottomRight=new hb,this.bottomLeft=new hb}return a.prototype={getArray:function(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]},getCssValueHori:function(){return h.map(this.getArray(),function(a){return a.getCssValueHori()}).join(" ")},getCssValueVert:function(){return h.map(this.getArray(),function(a){return a.getCssValueVert()}).join(" ")},getCssValue:function(){return[this.getCssValueHori(),this.getCssValueVert()].join("/")},getCss:function(){var a={},b=this.getCssValue();return a["border-radius"]=b,h.iter(n.cssVenderPrefixes,function(c){var d=[c,"border-radius"].join("-");a[d]=b}),a},getCorner:function(a,b){var c=cb.getCornerName(a,b);return this[c]},setSize:function(a,b){"undefined"!=typeof b["start-before"]&&this.setStartBefore(a,b["start-before"]),"undefined"!=typeof b["start-after"]&&this.setStartAfter(a,b["start-after"]),"undefined"!=typeof b["end-before"]&&this.setEndBefore(a,b["end-before"]),"undefined"!=typeof b["end-after"]&&this.setEndAfter(a,b["end-after"])},setStartBefore:function(a,b){var c=this.getCorner(a.getPropStart(),a.getPropBefore());c.setSize(b)},setStartAfter:function(a,b){var c=this.getCorner(a.getPropStart(),a.getPropAfter());c.setSize(b)},setEndBefore:function(a,b){var c=this.getCorner(a.getPropEnd(),a.getPropBefore());c.setSize(b)},setEndAfter:function(a,b){var c=this.getCorner(a.getPropEnd(),a.getPropAfter());c.setSize(b)},clearBefore:function(a){this.setStartBefore(a,[0,0]),this.setEndBefore(a,[0,0])},clearAfter:function(a){this.setStartAfter(a,[0,0]),this.setEndAfter(a,[0,0])}},a}(),jb=function(){function a(){}return a.prototype={setColor:function(a,b){var c=this;bb.setValue(this,a,b),bb.iter(this,function(a,b){c[a]=new K(b)})},getCss:function(){var a={};return bb.iter(this,function(b,c){var d=["border",b,"color"].join("-");a[d]=c.getCssValue()}),a}},a}(),kb=function(){function a(){}return a.prototype={setStyle:function(a,b){bb.setValue(this,a,b)},getCss:function(){var a={};return bb.iter(this,function(b,c){var d=["border",b,"style"].join("-");a[d]=c}),a}},a}(),lb=function(){function a(){gb.call(this,"padding")}return g.extend(a,gb),a}(),mb=function(){function a(){gb.call(this,"margin")}return g.extend(a,gb),a}(),nb=function(){function a(){gb.call(this,"border")}return g.extend(a,gb),a.prototype.clearBefore=function(a){this.setBefore(a,0),this.radius&&this.radius.clearBefore(a)},a.prototype.clearAfter=function(a){this.setAfter(a,0),this.radius&&this.radius.clearAfter(a)},a.prototype.getDirProp=function(a){return["border",a,"width"].join("-")},a.prototype.setRadius=function(a,b){this.radius=new ib,this.radius.setSize(a,b)},a.prototype.setColor=function(a,b){this.color=new jb,this.color.setColor(a,b)},a.prototype.setStyle=function(a,b){this.style=new kb,this.style.setStyle(a,b)},a.prototype.getCss=function(){var a=gb.prototype.getCss.call(this);return this.radius&&r.copy(a,this.radius.getCss()),this.color&&r.copy(a,this.color.getCss()),this.style&&r.copy(a,this.style.getCss()),a},a}(),ob=function(){function a(a,b){switch(arguments.length){case 1:this.parts=a;break;case 2:this.parts=this._mapSize(a,b)}}return a.prototype={getLength:function(){return this.parts.length},getSize:function(a){return this.parts[a]||null},_mapSize:function(a,b){var c=h.filter(a,function(a){return 0===a}),d=c.length;if(0===d)return a;var e=h.sum(a),f=b-e,g=Math.round(f/d);return h.map(a,function(a){return a?a:g})}},a}(),pb=function(){function a(){this.entry={}}return a.prototype={add:function(a){var b=a.getLength();this.entry[b]=a},getPartition:function(a){return this.entry[a]||null}},a}(),qb=function(){function a(a){this.value=a||"filled dot"}var b="filled dot",c={"filled dot":"&#x2022;","open dot":"&#x25e6;","filled circle":"&#x25cf;","open circle":"&#x25cb;","filled double-circle":"&#x25c9;","open double-circle":"&#x25ce;","filled triangle":"&#x25b2;","open triangle":"&#x25b3;","filled sesame":"&#xfe45;","open sesame":"&#xfe46;"};return a.prototype={setValue:function(a){this.value=a},getText:function(){return c[this.value]||this.value||c[b]},getCss:function(){var a={};return a}},a}(),rb=function(){function a(a){this.value=a||"over"}return a.prototype={isEmphaFirst:function(){return"over"===this.value||"left"===this.value||"before"===this.value},setValue:function(a){this.value=a},getCss:function(){var a={};return a}},a}(),sb=function(){function a(){this.pos=new rb,this.style=new qb,this.color=new K(d.fontColor)}return a.prototype={setPos:function(a){this.pos.setValue(a)},setStyle:function(a){this.style.setValue(a)},setColor:function(a){this.color.setValue(a)},getText:function(){return this.style.getText()},getExtent:function(a){return 3*a},getCssVertEmphaWrap:function(a,b){var c={},d=a.getFontSize();return c["padding-left"]="0.5em",c.width=this.getExtent(d)+"px",c.height=b.getAdvance(a.flow,a.letterSpacing)+"px",c},getCssHoriEmphaWrap:function(a,b){var c={},d=a.getFontSize();return c.display="inline-block",c["padding-top"]=-d+"px",c.width=b.getAdvance(a.flow,a.letterSpacing)+"px",c.height=this.getExtent(d)+"px",c}},a}(),tb=function(){function a(){this.padding=new lb,this.margin=new mb,this.border=new nb}return a.prototype={isEnable:function(){return this.padding.isEnable()||this.margin.isEnable()||this.border.isEnable()},clear:function(){this.padding.clear(),this.margin.clear(),this.border.clear()},getCss:function(){var a={};return r.copy(a,this.padding.getCss()),r.copy(a,this.margin.getCss()),r.copy(a,this.border.getCss()),a},getWidth:function(){var a=0;return a+=this.padding.getWidth(),a+=this.margin.getWidth(),a+=this.border.getWidth()},getHeight:function(){var a=0;return a+=this.padding.getHeight(),a+=this.margin.getHeight(),a+=this.border.getHeight()},getMeasureSize:function(a){var b=0;return b+=this.padding.getMeasureSize(a),b+=this.margin.getMeasureSize(a),b+=this.border.getMeasureSize(a)},getExtentSize:function(a){var b=0;return b+=this.padding.getExtentSize(a),b+=this.margin.getExtentSize(a),b+=this.border.getExtentSize(a)},setAll:function(a,b,c){this[a].setAll(b,c)},setSize:function(a,b,c){this[a].setSize(b,c)},setEdgeSize:function(a,b){for(var c in b)this.setSize(c,a,b[c])},setEdgeStart:function(a,b,c){this[a].setStart(b,c)},setEdgeEnd:function(a,b,c){this[a].setEnd(b,c)},setEdgeBefore:function(a,b,c){this[a].setBefore(b,c)},setEdgeAfter:function(a,b,c){this[a].setAfter(b,c)},setBorderRadius:function(a,b){this.border.setRadius(a,b)},setBorderColor:function(a,b){this.border.setColor(a,b)},setBorderStyle:function(a,b){this.border.setStyle(a,b)},clearBorderStart:function(a){this.border.clearStart(a)},clearBorderBefore:function(a){this.border.clearBefore(a)},clearBorderAfter:function(a){this.border.clearAfter(a)}},a}(),ub=function(){function a(a,b){this.width=a,this.height=b}return a.prototype={isValid:function(){return this.width>0&&this.height>0},canInclude:function(a){return a.width<=this.width&&a.height<=this.height},getCss:function(){var a={};return a.width=this.width+"px",a.height=this.height+"px",a},getWhSlope:function(){return this.height/this.width},getHwSlope:function(){return this.width/this.height},getMeasure:function(a){return this[a.getPropMeasure()]},getExtent:function(a){return this[a.getPropExtent()]},setExtent:function(a,b){this[a.getPropExtent()]=b},setMeasure:function(a,b){this[a.getPropMeasure()]=b},subEdge:function(a){var b=a.getWidth(),c=a.getHeight();this.width=Math.max(0,this.width-b),this.height=Math.max(0,this.height-c)},subMeasure:function(a,b){var c=a.getPropMeasure();this[c]=Math.max(0,this[c]-b)},addMeasure:function(a,b){this[a.getPropMeasure()]+=b},addExtent:function(a,b){this[a.getPropExtent()]+=b},percentFrom:function(a){return Math.round(100*this.width/a.width)},resizeWithin:function(a,b){var c=b.getMeasure(a),d=b.getExtent(a),e=this.getMeasure(a),f=this.getExtent(a);if(f>d&&(e=e*d/f,f=d),e>c){var g=f/e,h=e-c;f=Math.round(f-g*h),e=c}return a.getBoxSize(e,f)}},a}(),vb=function(){function a(){this.forward=[],this.normal=[],this.backward=[]}return a.prototype={get:function(){return this.forward.concat(this.normal).concat(this.backward)},getNormal:function(){return this.normal},setNormal:function(a){this.normal=a},getLength:function(){return this.forward.length+this.normal.length+this.backward.length},getFirst:function(){return this.forward.length>0?this.forward[0]:this.normal.length>0?this.normal[0]:this.backward.length>0?this.backward[this.backward.length-1]:null},add:function(a){a.backward?this.backward.unshift(a):a.forward?this.forward.push(a):this.normal.push(a)}},a}(),wb=function(){function a(a,b){b=b||{},this.position=a,this.top="undefined"!=typeof b.top?b.top:"auto",this.left="undefined"!=typeof b.left?b.left:"auto",this.right="undefined"!=typeof b.right?b.right:"auto",this.bottom="undefined"!=typeof b.bottom?b.bottom:"auto"}return a.prototype={isAbsolute:function(){return"absolute"===this.position},getCss:function(){var a={};return a.position=this.position,a.top=this.top,a.left=this.left,a.right=this.right,a.bottom=this.bottom,a}},a}(),xb=function(){function a(a,b,c){c=c||{},this._type=c.type||"div",this.markup=c.markup||null,this.position=c.position||new wb("relative"),this.parent=b,this.size=a,this.childExtent=0,this.childMeasure=0,this.childs=new vb,this.css={},this.charCount=0}return a.prototype={getMarkup:function(){return this.markup},getCssBlock:function(){var a=this.css;return r.copy(a,this.size.getCss()),r.copy(a,this.position.getCss()),this.font&&r.copy(a,this.font.getCss()),this.edge&&r.copy(a,this.edge.getCss()),this.parent&&r.copy(a,this.parent.flow.getCss()),this.color&&r.copy(a,this.color.getCss()),this.background&&r.copy(a,this.background.getCss(this.flow)),this.letterSpacing&&!this.isTextVertical()&&(a["letter-spacing"]=this.letterSpacing+"px"),a.display=this.display,a.overflow="hidden",this.zIndex&&(a["z-index"]=this.zIndex),a},getCssInline:function(){var a=this.css;this.font&&r.copy(a,this.font.getCss()),this.color&&r.copy(a,this.color.getCss()),this.background&&r.copy(a,this.background.getCss()),this.parent&&this.parent.isBlock()&&r.copy(a,this.flow.getCss());var b=this.getStartOffset();if(b>0){this.edge=new mb,this.edge.setStart(this.flow,b);var c=this.getContentMeasure();this.size.setMeasure(this.flow,c-b)}return r.copy(a,this.size.getCss()),this.edge&&r.copy(a,this.edge.getCss()),this.isTextVertical()&&(a["line-height"]="1em",e.isIphoneFamily&&(a["letter-spacing"]="-0.001em"),"undefined"!=typeof this.markup&&this.isRubyLine()||(a["margin-left"]=a["margin-right"]="auto",a["text-align"]="center")),a},getCssVertInlineBox:function(){var a=this.getCssBlock();return a["float"]="none",a["margin-left"]=a["margin-right"]="auto",a},getCharCount:function(){return this.charCount},getClasses:function(){return this.isTextLine()?this._getClassesInline():this._getClassesBlock()},getCssClasses:function(){return this.getClasses().join(" ")},_getClassesBlock:function(){var a=["nehan-box"];return"box"!=this._type&&a.push(o.addNehanPrefix(this._type)),a.concat(this.extraClasses||[])},_getClassesInline:function(){var a=["nehan-text-line"];return a.push("nehan-text-line-"+(this.isTextVertical()?"vert":"hori")),this.markup&&"body"!==this.markup.getName()&&a.push("nehan-"+this.markup.getName()),a.concat(this.extraClasses||[])},getChilds:function(){return this.childs.get()},getChildExtent:function(){return this.childExtent},getChildMeasure:function(){return this.childMeasure},getFlowName:function(){return this.flow.getName()},getFlipFlow:function(){return this.flow.getFlipFlow()},getFontSize:function(){return this.font?this.font.size:d.fontSize},getFontFamily:function(){return this.font?this.font.family:"monospace"},getTextMeasure:function(){return this.childMeasure},getRestContentMeasure:function(){return this.getContentMeasure()-this.childMeasure},getRestContentExtent:function(){return this.getContentExtent()-this.childExtent},getContentMeasure:function(a){return this.size.getMeasure(a||this.flow)},getContentExtent:function(a){return this.size.getExtent(a||this.flow)},getMaxChildMeasure:function(a){var b=a||this.flow,c=0;return h.iter(this.getChilds(),function(a){var d=a.getTextMeasure?a.getTextMeasure():a.getContentMeasure(b);d>c&&(c=d)}),c},getContentWidth:function(){return this.size.width},getContentHeight:function(){return this.size.height},getBoxMeasure:function(a){var b=a||this.flow,c=this.getContentMeasure(b);return this.edge&&(c+=this.edge.getMeasureSize(b)),c},getBoxExtent:function(a){var b=a||this.flow,c=this.getContentExtent(b);return this.edge&&(c+=this.edge.getExtentSize(b)),c},getStartOffset:function(){var a=this.textIndent||0;switch(this.textAlign){case"start":return a;case"end":return a+this.getRestContentMeasure();case"center":return a+Math.round(this.getRestContentMeasure()/2);default:return a}},getRestSize:function(){var a=this.getRestContentMeasure(),b=this.getRestContentExtent();return this.flow.getBoxSize(a,b)},getFloatedWrapFlow:function(){return this.flow.getFloatedWrapFlow()},getParentFlow:function(){return this.parent?this.parent.flow:null},getParallelFlow:function(){return this.flow.getParallelFlow()},getParallelFlipFlow:function(){return this.flow.getParallelFlipFlow()},getPropStart:function(){return this.flow.getPropStart()},getPropAfter:function(){return this.flow.getPropAfter()},getInflow:function(){return this.flow.inflow},getBlockflow:function(){return this.flow.blockflow},getBoxFlowBoxSize:function(a,b){return this.flow.getBoxSize(a,b)},getEdgeWidth:function(){return this.sizing&&!this.sizing.containEdgeSize()?0:this.edge?this.edge.getWidth():0},getEdgeHeight:function(){return this.sizing&&!this.sizing.containEdgeSize()?0:this.edge?this.edge.getHeight():0},getMarkupName:function(){return this.markup?this.markup.getName():""},addClass:function(a){var b=this.extraClasses||[];b.push(a),this.extraClasses=b},addChildBlock:function(a){this.childs.add(a),a.isPositionAbsolute()||(this.childExtent+=a.getBoxExtent(this.flow)),this.charCount+=a.getCharCount()},addParaChildBlock:function(a){this.childs.add(a),this.childExtent=Math.max(a.getBoxExtent(this.flow),this.childExtent),this.charCount+=a.getCharCount()},setChildMeasure:function(a){this.childMeasure=a},setInlineElements:function(a,b){this.childs.setNormal(a),this.childMeasure=b},setCss:function(a,b){this.css[a]=b},setType:function(a){this._type=a},setId:function(a){this.id=a},setParent:function(a,b){var c="undefined"!=typeof b?b:!0;this.parent=a,c&&this.setFlow(a.flow)},setFlow:function(a){a.isValid()&&(this.flow=a)},setDisplay:function(a){this.display=a},setContentExtent:function(a,b){this.size.setExtent(a,b)},setContentMeasure:function(a,b){this.size.setMeasure(a,b)},setEdge:function(a){var b=this.sizing?this.sizing:eb.getByName("margin-box"),c=b.getSubEdge(a);this.size.subEdge(c),this.size.isValid()&&(this.edge=a)},setMaxFontSize:function(b){this.maxFontSize=b,h.iter(this.getChilds(),function(c){c instanceof a&&"text-line"===c._type&&c.setMaxFontSize(b)})},setMaxExtent:function(b){this.maxExtent=b,h.iter(this.getChilds(),function(c){c instanceof a&&"text-line"===c._type&&c.setMaxExtent(b)})},subMeasure:function(a){this.size.subMeasure(this.flow,a)},splitMeasure:function(a){for(var b=this.getContentMeasure(),c=Math.round(b/a),d=[],e=0;a>e;e++)d.push(c);return d},isBlock:function(){return!this.isTextLine()},isDisplayNone:function(){return"none"===this.display},isPositionAbsolute:function(){return this.position.isAbsolute()},isTextLine:function(){return"text-line"===this._type},isTextLineRoot:function(){return this.parent&&this.parent.isBlock()},isInlineOfInline:function(){return this.parent&&this.parent.isTextLine()},isRubyLine:function(){return this.isTextLine()&&"ruby"===this.getMarkupName()},isLinkLine:function(){return this.isTextLine()&&"a"===this.getMarkupName()},isPreLine:function(){return this.isTextLine()&&this.markup&&"pre"===this.markup.getWhiteSpace()},isJustifyTarget:function(){var a=this.getMarkupName();return"first-letter"!==a&&"rt"!==a&&"li-marker"!==a},isTextVertical:function(){return this.flow.isTextVertical()},isTextHorizontal:function(){return this.flow.isTextHorizontal()},isValidSize:function(){return this.size.isValid()},canInclude:function(a){return this.size.canInclude(a)},clearEdge:function(){this.edge&&this.edge.clear()},clearBorderBefore:function(){this.edge&&this.edge.clearBorderBefore(this.flow)},clearBorderAfter:function(){this.edge&&this.edge.clearBorderAfter(this.flow)},shortenBox:function(a){var b=a||this.flow;return this.shortenMeasure(b),this.shortenExtent(b),this},shortenMeasure:function(a){return a=a||this.flow,this.size.setMeasure(a,this.childMeasure),this},shortenExtent:function(a){return a=a||this.flow,this.setContentExtent(a,this.childExtent),this}},a}(),yb={set:function(a,b,c){this._setDisplay(a,b,c),this._setPosition(a,b,c),this._setZIndex(a,b,c),this._setColor(a,b,c),this._setFont(a,b,c),this._setBoxSizing(a,b,c),this._setEdge(a,b,c),this._setLineRate(a,b,c),this._setTextAlign(a,b,c),this._setTextIndent(a,b,c),this._setTextEmphasis(a,b,c),this._setFlowName(a,b,c),this._setFloat(a,b,c),this._setLetterSpacing(a,b,c),this._setBackground(a,b,c),this._setClasses(a,b,c)},_setDisplay:function(a,b){b.display=a.getCssAttr("display","block")},_setPosition:function(a,b){var c=a.getCssAttr("position","relative");b.position=new wb(c,{top:a.getCssAttr("top","auto"),left:a.getCssAttr("left","auto"),right:a.getCssAttr("right","auto"),bottom:a.getCssAttr("bottom","auto")})},_setZIndex:function(a,b){var c=a.getCssAttr("z-index");c&&(b.zIndex=c)},_setClasses:function(a,b){h.iter(a.classes,function(a){b.addClass(a)})},_setColor:function(a,b){var c=a.getCssAttr("color");c&&(b.color=new K(c))},_setFont:function(a,b){var c=a.getCssAttr("font-family");c&&(b.font.family=c);var d=a.getCssAttr("font-weight");d&&(b.font.weight=d);var e=a.getCssAttr("font-style");e&&(b.font.style=e);var f=a.getCssAttr("font-size","inherit");"inherit"!==f&&(b.font.size=j.getFontSize(f,b.getFontSize()))},_setBoxSizing:function(a,b){var c=a.getCssAttr("box-sizing");c&&(b.sizing=eb.getByName(c))},_setEdge:function(a,b){var c=a.getCssAttr("padding"),d=a.getCssAttr("margin"),e=a.getCssAttr("border-width"),f=a.getCssAttr("border-radius");if(null===c&&null===d&&null===e&&null===f)return null;var g=new tb;c&&g.setSize("padding",b.flow,j.getEdgeSize(c,b.getFontSize())),d&&g.setSize("margin",b.flow,j.getEdgeSize(d,b.getFontSize())),e&&g.setSize("border",b.flow,j.getEdgeSize(e,b.getFontSize())),f&&g.setBorderRadius(b.flow,j.getCornerSize(f,b.getFontSize()));var h=a.getCssAttr("border-color");h&&g.setBorderColor(b.flow,h);var i=a.getCssAttr("border-style");i&&g.setBorderStyle(b.flow,i),b.setEdge(g)},_setLineRate:function(a,b){var c=a.getCssAttr("line-rate","inherit");"inherit"!==c&&(b.lineRate=c)},_setTextAlign:function(a,b){var c=a.getCssAttr("text-align");c&&(b.textAlign=c)},_setTextIndent:function(a,b){var c=a.getCssAttr("text-indent","inherit");"inherit"!==c&&(b.textIndent=Math.max(0,j.getUnitSize(c,b.getFontSize())))},_setTextEmphasis:function(a,b){var c=a.getCssAttr("text-emphasis-style");if(c){var d=a.getCssAttr("text-emphasis-position","over"),e=a.getCssAttr("text-emphasis-color","black"),f=new sb;f.setStyle(c),f.setPos(d),f.setColor(e),b.textEmpha=f}},_setFlowName:function(a,b,c){var d=a.getCssAttr("flow","inherit");"flip"===d?b.setFlow(c.getFlipFlow()):"inherit"!==d&&b.setFlow(ab.getByName(d))},_setFloat:function(a,b){var c=a.getCssAttr("float","none");"none"!=c&&(b.logicalFloat=c)},_setLetterSpacing:function(a,b){var c=a.getCssAttr("letter-spacing");c&&(b.letterSpacing=j.getUnitSize(c,b.getFontSize()))},_setBackground:function(a,b){var c=a.getCssAttr("background-color"),d=a.getCssAttr("background-image"),e=a.getCssAttr("background-position"),f=a.getCssAttr("background-repeat");if(null!==c||null!==d||null!==e||null!==f){var g=new $;c&&(g.color=c),d&&(g.image=d),e&&(g.pos=new X(new W(e.inline,e.offset),new W(e.block,e.offset))),f&&(g.repeat=new Z(new Y(f.inline),new Y(f.block))),b.background=g}}},zb=function(){function a(a){this.pos=0,this.buff=this._normalize(a),this.src=this.buff}var b=/\d\d|!\?|!!|\?!|\?\?/,c=/^([\w!\.\?\/\_:#;"',]+)/,d=/^(<[^>]+>)/,e=/^(&[^;\s]+;)/;return a.prototype={_normalize:function(a){return a.replace(/(<\/[^>]+>)/g,function(a){return a.toLowerCase()}).replace(/^[ \n]+/,"").replace(/\s+$/,"").replace(/\r/g,"")},isEmpty:function(){return""===this.src},get:function(){var a=this._getToken();return a&&(a.spos=this.pos),a},getSrc:function(){return this.src},getSeekPercent:function(a){return Math.round(100*a/this.src.length)},_stepBuff:function(a){this.pos+=a,this.buff=this.buff.slice(a)},_getToken:function(){if(""===this.buff)return null;if(this.buff.match(d))return this._parseTag(RegExp.$1);if(this.buff.match(c)){var a=RegExp.$1;return 1===a.length?this._parseChar(a):2===a.length&&a.match(b)?this._parseTcy(a):this._parseWord(a)}return this.buff.match(e)?this._parseCharRef(RegExp.$1):this._parseChar(this._getChar())},_getRb:function(){var a=this.buffRb.substring(0,1);return this.buffRb=this.buffRb.slice(1),a},_getChar:function(){return this.buff.substring(0,1)},_getTagContentAux:function(a){var b=new RegExp("<"+a+"[\\s|>]"),c="</"+a+">",d=function(d){var e=d.indexOf(c);if(0>e)return-1;var f=d.match(b),g=f?f.index:-1;if(0>g||g>e)return e;var h=g+a.length+2,i=arguments.callee(d.substring(h));if(0>i)return-1;var j=h+i+a.length+3;return j+arguments.callee(d.substring(j))},e=d(this.buff);return 0>e?this.buff:this.buff.substring(0,e)},_getTagContent:function(a){try{return this._getTagContentAux(a)}catch(b){return""}},_parseTag:function(a){var b=new D(a);return this._stepBuff(a.length),b.isTcyTag()?this._parseTcyTag(b):b.isSingleTag()?b:this._parseChildContentTag(b)},_parseTcyTag:function(a){var b=this._getTagContent(a.name);return this._stepBuff(b.length+a.name.length+3),new H(b)},_parseChildContentTag:function(a){var b=this._getTagContent(a.name);return a.setContentRaw(k.trimCRLF(b)),this._stepBuff(b.length+a.name.length+3),a},_parseWord:function(a){return this._stepBuff(a.length),new G(a)},_parseTcy:function(a){return this._stepBuff(a.length),new H(a)},_parseChar:function(a){return this._stepBuff(a.length),new F(a,!1)},_parseCharRef:function(a){return this._stepBuff(a.length),new F(a,!0)}},a}(),Ab=function(){function a(a,b,c){this.rank=a,this.title=b,this._id=c||0}return a.prototype={getId:function(){return this._id}},a}(),Bb=function(){function a(a,b,c){this._type=a,this._header=null,this._auto=!1,this._next=null,this._child=null,this._parent=b||null,this._pageNo=c||0}return a.prototype={isRoot:function(){return null===this._parent},isAuto:function(){return this._auto},hasHeader:function(){return null!==this._header},hasHeaderId:function(){return this.getHeaderId()>0},hasChild:function(){return null!==this._child},hasNext:function(){return null!==this._next},getNext:function(){return this._next},getChild:function(){return this._child},getParent:function(){return this._parent},getHeader:function(){return this._header},getHeaderId:function(){return this._header?this._header.getId():null},setHeader:function(a){this._header=a},setAuto:function(){this._auto=!0},getRank:function(){return this._header?this._header.rank:0},getTitle:function(){return this._header?this._header.title:["untitled",this._type].join(" ")},getType:function(){return this._type},getPageNo:function(){return this._pageNo},updatePageNo:function(a){this._pageNo=a},addChild:function(a){null===this._child?this._child=a:this._child.addNext(a)},addNext:function(a){null===this._next?this._next=a:this._next.addNext(a)}},a}(),Cb=function(){function a(){this.stack=[1]}return a.prototype={getTocStack:function(){return this.stack},getTocId:function(){return this.stack.join(".")},stepNext:function(){var a=this.stack.length;return a>0&&this.stack[a-1]++,this},startRoot:function(){return this.stack.push(1),this},endRoot:function(){return this.stack.pop(),this}},a}(),Db=function(){function a(a){this.rootName=a,this.logs=[]}return a.prototype={isEmpty:function(){return 0===this.logs.length},get:function(a){return this.logs[a]||null},getSectionRootName:function(){return this.rootName},addSectionLog:function(a){this.logs.push(a)},addHeaderLog:function(a){var b=this._findLog(a);return b>=0?void(this.logs[b]=a):void this.logs.push(a)},_findLog:function(a){for(var b=this.logs.length-1;b>=0;b--)if(a.headerId===this.logs[b].headerId)return b;return-1}},a}(),Eb=function(){function a(){this._buffers={},this._stack=[],this._curSection="body"}return a.prototype={_addHeaderLog:function(a){var b=this.getOutlineBuffer(this._curSection);b.addHeaderLog(a)},_addSectionLog:function(a){var b=this.getOutlineBuffer(this._curSection);b.addSectionLog(a)},_getCurSection:function(){return this._stack.length>0?this._stack[this._stack.length-1]:"body"},getOutlineBuffer:function(a){var b=this._buffers[a]||new Db(a);return this._buffers[a]=b,b},startSectionRoot:function(a){this._stack.push(a),this._curSection=a},endSectionRoot:function(){return this._stack.pop(),this._curSection=this._getCurSection(),this._curSection},logStartSection:function(a,b){this._addSectionLog({name:"start-section",type:a,pageNo:b})},logEndSection:function(a){this._addSectionLog({name:"end-section",type:a})},logSectionHeader:function(a,b,c,d,e){this._addHeaderLog({name:"set-header",type:a,rank:b,title:c,pageNo:d,headerId:e})}},a}(),Fb=function(){function a(a){this._ptr=0,this._logs=a,this._root=new Bb("section",null,0)}return a.prototype={getTree:function(){return this._parse(this._root,this),this._root},_getNext:function(){return this._logs.get(this._ptr++)},_rollback:function(){this._ptr=Math.max(0,this._ptr-1)},_parse:function(a,b){var c=b._getNext();if(null!==c)switch(c.name){case"start-section":var d=new Bb(c.type,a,c.pageNo);a&&a.addChild(d),arguments.callee(d,b);break;case"end-section":arguments.callee(a.getParent(),b);break;case"set-header":var e=new Ab(c.rank,c.title,c.headerId);if(null===a){var f=new Bb("section",null,c.pageNo);f.setHeader(e),arguments.callee(f,b)}else if(a.hasHeader()){var g=c.rank,h=a.getRank();if(h>g)b._rollback(),arguments.callee(a.getParent(),b);else if(c.rank==h){var i=new Bb("section",a,c.pageNo);i.setHeader(e),a.addNext(i),arguments.callee(i,b)}else{var j=new Bb("section",a,c.pageNo);j.setHeader(e),a.addChild(j),arguments.callee(j,b)}}else a.setHeader(e),arguments.callee(a,b)}}},a}(),Gb=function(){function a(a,b){this.tree=a,r.copy(this,b||{})}return a.prototype={outputNode:function(){var a=new Cb;return this._parseTree(this,this.createRoot(),this.tree,a)},_createToc:function(a,b){return{title:a.getTitle(),pageNo:a.getPageNo(),tocId:b.getTocId(),headerId:a.getHeaderId()}},_parseTree:function(a,b,c,d){if(null===c)return b;var e=a._createToc(c,d),f=a.createChild(e),g=a.createLink(e);g&&(g.onclick=function(){return a.onClickLink(e)},f.appendChild(g));var h=a.createPageNoItem(e);h&&f.appendChild(h),b.appendChild(f);var i=c.getChild();if(i){d=d.startRoot();var j=a._createToc(i,d),k=a.createRoot(j);arguments.callee(a,k,i,d),f.appendChild(k),d=d.endRoot()}var l=c.getNext();return l&&arguments.callee(a,b,l,d.stepNext()),b},onClickLink:function(){return!1},createRoot:function(){var a=document.createElement("ol");return a.className="nehan-toc-root",a},createChild:function(){var a=document.createElement("li");return a.className="nehan-toc-item",a},createLink:function(a){var b=document.createElement("a"),c=a.title.replace(/<a[^>]+>/gi,"").replace(/<\/a>/gi,"");return b.href="#"+a.pageNo,b.innerHTML=c,b.className="nehan-toc-link",b.id=o.addNehanTocLinkPrefix(a.tocId),b},createPageNoItem:function(){return null}},a}(),Hb=function(){function a(){this.title="",this.metas=[],this.links=[],this.scripts=[],this.styles=[]}return a.prototype={setTitle:function(a){this.title=a},getTitle:function(){return this.title},addLink:function(a){this.links.push(a)},getLinks:function(){return this.links},addMeta:function(a){this.metas.push(a)},getMetas:function(){return this.metas},getMetaByName:function(a){return h.find(this.metas,function(b){return b.getTagAttr("name")===a})},getMetaContentByName:function(a){var b=this.getMetaByName(a);return b?b.getTagAttr("content"):null},addScript:function(a){this.scripts.push(a)},getScripts:function(){return this.scripts},addStyle:function(a){this.styles.push(a)},getStyles:function(){return this.styles}},a}(),Ib=function(){function a(a){var b=a||{};this.markup=b.markup||null,this.stream=b.stream||null,this.charPos=b.charPos||0,this.localPageNo=b.localPageNo||0,this.localLineNo=b.localLineNo||0,this.header=b.header||new Hb,this.blockContext=b.blockContext||null,this.inlineContext=b.inlineContext||null,this.outlineContext=b.outlineContext||new Eb,this.anchors=b.anchors||{}}var b=0,c=0;return a.prototype={setDocumentType:function(a){this.documentType=a},isFirstLocalPage:function(){return 0===this.localPageNo},isFirstLocalLine:function(){return 0===this.localLineNo},stepLocalPageNo:function(){return this.localPageNo++,this.localPageNo},getLocalPageNo:function(){return this.localPageNo},getStream:function(){return this.stream},getStreamSrc:function(){return this.stream.getSrc()},hasNextToken:function(){return this.stream.hasNext()},getNextToken:function(){return this.stream.get()},pushBackToken:function(){this.stream.prev()},getStreamPos:function(){return this.stream.getPos()},getSeekPos:function(){return this.stream.getSeekPos()},getSeekPercent:function(){return this.stream.getSeekPercent()
},getStreamTokenCount:function(){return this.stream.getTokenCount()},isStreamHead:function(){return this.stream.isHead()},inheritMarkup:function(a,b){return b=b||this.markup,a.inherit(b,this)},getMarkup:function(){return this.markup},getMarkupStaticSize:function(a){var b=a?a.getFontSize():d.fontSize,c=a?a.getContentMeasure(a.flow):d.getStdMeasure();return this.markup?this.markup.getStaticSize(b,c):null},getMarkupName:function(){return this.markup?this.markup.getName():""},getMarkupClasses:function(){return this.markup?this.markup.classes:[]},createBlockRoot:function(b,c){return c=null===c?null:c||new Lb(b.getContent()),new a({markup:b?this.inheritMarkup(b,this.markup):null,stream:c,charPos:this.charPos,header:this.header,outlineContext:this.outlineContext,anchors:this.anchors})},createFloatedRoot:function(){return new a({markup:this.markup,stream:this.stream,charPos:this.charPos,header:this.header,blockContext:this.blockContext,outlineContext:this.outlineContext,anchors:this.anchors})},createInlineBlockRoot:function(a,b){var c=this.createBlockRoot(a,b);return c.mode="inline-block",c},createBlockContext:function(a){return this.blockContext=new bc(a),this.blockContext},addBlockElement:function(a){this.blockContext.addElement(a),a.isTextLine()&&this.localLineNo++},canContainExtent:function(a){return this.blockContext?this.blockContext.getRestExtent()>=a:!0},createInlineRoot:function(b,c){return c=null===c?null:c||new Lb(b.getContent()),new a({markup:this.inheritMarkup(b,this.markup),stream:c,charPos:this.charPos,header:this.header,blockContext:this.blockContext,outlineContext:this.outlineContext,anchors:this.anchors})},createChildInlineRoot:function(a,b){var c=this.createInlineRoot(a,b);return c.blockContext=null,c},createInlineStream:function(){return this.stream.createRefStream(function(a){return null!==a&&E.isInline(a)})},createInlineContext:function(a){return this.inlineContext=new ac(a,this.stream),this.inlineContext},createLine:function(){return this.inlineContext.createLine()},getRestMeasure:function(){return this.inlineContext?this.inlineContext.getRestMeasure():0},getInlineNextToken:function(){return this.inlineContext.getNextToken()},getInlineMaxMeasure:function(){return this.inlineContext.getMaxMeasure()},getInlineMaxExtent:function(){return this.inlineContext.getMaxExtent()},getInlineMaxFontSize:function(){return this.inlineContext.getMaxFontSize()},getInlineFontSize:function(){return this.inlineContext?this.inlineContext.getFontSize():d.fontSize},setLineBreak:function(){this.inlineContext.setLineBreak()},isJustified:function(){return this.inlineContext.isJustified()},restartInlineContext:function(a){this.inlineContext.restart(a)},addInlineElement:function(a){this.inlineContext.addElement(a)},getHeader:function(){return this.header},addScript:function(a){this.header.addScript(a)},addStyle:function(a){this.header.addStyle(a)},getPageNo:function(){return c},getCharPos:function(){return this.charPos},stepPageNo:function(){c++},addCharPos:function(a){this.charPos+=a},setAnchor:function(a){this.anchors[a]=this.getPageNo()},getAnchors:function(){return this.anchors},getAnchorPageNo:function(a){return this.anchors[a]||-1},getOutlineBuffer:function(a){return this.outlineContext.getOutlineBuffer(a)},startSectionRoot:function(){var a=this.markup.getName();this.outlineContext.startSectionRoot(a)},endSectionRoot:function(){var a=this.markup.getName();return this.outlineContext.endSectionRoot(a)},logStartSection:function(){var a=this.markup.getName();this.outlineContext.logStartSection(a,this.getPageNo())},logEndSection:function(){var a=this.markup.getName();this.outlineContext.logEndSection(a)},logSectionHeader:function(){var a=this.markup.getName(),c=this.markup.getHeaderRank(),d=this.markup.getContentRaw(),e=this.getPageNo();return"undefined"==typeof this.markup.headerId&&(this.markup.headerId=b++),this.outlineContext.logSectionHeader(a,c,d,e,this.markup.headerId),this.markup.headerId}},a}(),Jb=function(){function a(a,b){this.rowCount=a,this.maxCol=b,this.map=this._create(a,b)}return a.prototype={_create:function(a,b){for(var c=[],d=function(a){for(var b=[],c=0;a>c;c++)b.push({start:0,end:0,before:0,after:0});return b},e=0;a>e;e++)c.push(d(b));return c},get:function(a,b){return this.map[a][b]},getAsStyle:function(a,b){var c=this.get(a,b),d={};for(var e in c)d[e]=c[e]+"px";return d},set:function(a,b,c){for(var d in c)this.setBorderProp(a,b,d,c)},collapse:function(){this._collapseCol(),this._collapseRow()},_collapseCol:function(){for(var a=0;a<this.rowCount;a++)for(var b=0;b<this.maxCol-1;b++){var c=this.get(a,b),d=this.get(a,b+1);c.end&&d.start&&(c.end>d.start?d.start=0:c.end=0)}},_collapseRow:function(){for(var a=0;a<this.rowCount-1;a++)for(var b=0;b<this.maxCol;b++){var c=this.get(a,b),d=this.get(a+1,b);c.after&&d.before&&(c.after>d.before?d.before=0:c.after=0)}},setBorderProp:function(a,b,c,d){var e=this.get(a,b);d[c]>e[c]&&(e[c]=d[c])},setRange:function(a,b,c,d,e){for(var f=a;c>f;f++)for(var g=b;d>g;g++)f==a&&this.setBorderProp(f,g,"before",e),f==c-1&&this.setBorderProp(f,g,"after",e),g==b&&this.setBorderProp(f,g,"start",e),g==d-1&&this.setBorderProp(f,g,"end",e)}},a}(),Kb=function(){var a=function(a,b){var c=b.getCssAttr("border-width");if(null===c)return null;var d=j.getEdgeSize(c,a.getFontSize(),a.getContentMeasure());return"number"==typeof d?{before:d,after:d,start:d,end:d}:d},b=function(b,c,d){var e=a(c,d);if(null!==e)switch(d.name){case"table":b.setRange(0,0,b.rowCount,b.maxCol,e);break;case"thead":case"tbody":case"tfoot":var f=d.row,g=f+d.tableChilds.length;b.setRange(f,0,g,b.maxCol);break;case"tr":b.setRange(d.row,0,d.row+1,b.maxCol);break;case"td":case"th":b.set(d.row,d.col,e)}},c=function(a,c,d){var e=arguments.callee;b(a,c,d),h.iter(d.tableChilds||[],function(b){e(a,c,b)})},d=function(a,b){var c=arguments.callee;switch(b.name){case"table":case"thead":case"tbody":case"tfoot":case"tr":b.setCssAttr("border-width","0px");break;case"td":case"th":var d=a.getAsStyle(b.row,b.col);b.setCssAttr("border-width",d)}h.iter(b.tableChilds||[],function(b){c(a,b)})};return{set:function(a,b){var e=new Jb(a.rowCount,a.maxCol);c(e,b,a),e.collapse(),d(e,a)}}}(),Lb=function(){function a(a){this.lexer=this._createLexer(a),this.tokens=[],this.pos=0,this.eof=!1,this._doBuffer()}return a.prototype={_createLexer:function(a){return new zb(a)},getSrc:function(){return this.lexer.getSrc()},hasNext:function(){return!this.eof||this.pos<this.tokens.length},isEmpty:function(){return this.lexer.isEmpty()},isEmptyTokens:function(){return 0===this.tokens.length},isHead:function(){return 0===this.pos},look:function(a){return this.tokens[a]||null},next:function(a){var b=a||1;this.pos=this.pos+b},prev:function(){this.pos=Math.max(0,this.pos-1)},setPos:function(a){this.pos=a},skipIf:function(a){var b=this.peek();b&&a(b)&&this.next()},skipUntil:function(a){for(;this.hasNext();){var b=this.get();if(null===b)break;if(!a(b)){this.prev();break}}},rewind:function(){this.pos=0},peek:function(a){var b=a||0,c=Math.max(0,this.pos+b);if(c>=this.tokens.length){if(this.eof)return null;this._doBuffer()}var d=this.tokens[c];return d.pos=c,d},get:function(){var a=this.peek();return this.pos++,a},getPos:function(){return this.pos},getAll:function(){for(;!this.eof;)this._doBuffer();return this.tokens},getAllIf:function(a){return h.filter(this.getAll(),function(b){return a(b)})},getTokenCount:function(){return this.tokens.length},getSeekPos:function(){var a=this.tokens[this.pos];return a?a.spos:0},getSeekPercent:function(){var a=this.getSeekPos();return this.lexer.getSeekPercent(a)},getWhile:function(a){for(var b=[],c=function(a){b.push(a)};this.hasNext();){var d=this.get();if(!d||!a(d)){this.prev();break}c(d)}return b},iterWhile:function(a,b){for(var c=1==arguments.length?this.pos:a;c>=0;){if(c>=this.tokens.length){if(this.eof)break;this._doBuffer(),this.iterWhile(c,b);break}if(!b(c,this.tokens[c]))break;c++}},revIterWhile:function(a,b){for(var c=1==arguments.length?this.pos:a;c>=0&&b(c,this.tokens[c]);)c--},findTextPrev:function(a){var b="undefined"!=typeof a?a:this.pos,c=null;return this.revIterWhile(b-1,function(a,b){return b?E.isText(b)?(c=b,!1):!1:!1}),c},findTextNext:function(a){var b="undefined"!=typeof a?a:this.pos,c=null;return this.iterWhile(b+1,function(a,b){return b?E.isText(b)?(c=b,!1):!1:!1}),c},_doBuffer:function(){for(var a=c.lexingBufferLen,b=0;a>b;b++){var d=this.lexer.get();if(null===d){this.eof=!0;break}this.tokens.push(d)}}},a}(),Mb=function(){function a(a,b){Lb.call(this,a);var c=0;this.tokens=this.getAllIf(function(a){return E.isText(a)?!1:b(a)?(a.order=c++,!0):void 0})}return g.extend(a,Lb),a}(),Nb=function(){function a(a){Lb.call(this,""),this.tokens=a}return g.extend(a,Lb),a.prototype.isEmpty=function(){return 0===this.tokens.length},a}(),Ob=function(){function a(a){Mb.call(this,a,function(a){var b=a.getName();return"!doctype"===b||"html"===b}),this.isEmptyTokens()&&(this.tokens=[new D("html",a)])}return g.extend(a,Mb),a}(),Pb=function(){function a(a){Mb.call(this,a,function(a){var b=a.getName();return"head"===b||"body"===b})}return g.extend(a,Mb),a}(),Qb=function(){function a(a){Mb.call(this,a,function(a){var b=a.getName();return"title"===b||"meta"===b||"link"===b||"style"===b||"script"===b})}return g.extend(a,Mb),a}(),Rb=function(){function a(a){Mb.call(this,a.getContent(),function(a){var b=a.getName();return"thead"===b||"tbody"===b||"tfoot"===b||"tr"===b}),this.markup=a,this.markup.tableChilds=this.tokens=this._parseTokens(this.markup,this.tokens)}return g.extend(a,Mb),a.prototype.getPartition=function(a){var b=this,c=new pb,d=a.getContentMeasure();return h.iter(this.tokens,function(e){var f=e.tableChilds;h.iter(f,function(e){var f=e.tableChilds,g=f.length;if(null===c.getPartition(g)){var h=b._parsePartition(f,a);c.add(new ob(h,d))}})}),c},a.prototype._parseTokens=function(a,b){var c=[],d=[],e=[],f=this,g=null,i=null,j=null,k={row:0,col:0,maxCol:0};h.iter(b,function(a){if(E.isTag(a))switch(a.name){case"tr":a.row=k.row,a.tableChilds=f._parseCols(k,a),k.row++,e.push(a);break;case"thead":g=a,c=c.concat(f._parseRows(k,a));break;case"tbody":i=a,e=e.concat(f._parseRows(k,a));break;case"tfoot":j=a,d=d.concat(f._parseRows(k,a))}});var l=[],m=0;return c.length>0&&(null===g&&(g=new D("<thead>")),g.tableChilds=c,g.row=m,m+=c.length,l.push(g)),e.length>0&&(null===i&&(i=new D("<tbody>")),i.tableChilds=e,i.row=m,m+=e.length,l.push(i)),d.length>0&&(null===j&&(j=new D("<tfoot>")),j.tableChilds=d,j.row=m,l.push(j)),this.markup.tableChilds=l,this.markup.maxCol=k.maxCol,this.markup.rowCount=k.row,l},a.prototype._parsePartition=function(a,b){return h.map(a,function(a){var c=a.getTagAttr("measure")||a.getTagAttr("width")||0;return c?j.getBoxSize(c,b.getFontSize(),b.getContentMeasure()):0})},a.prototype._parseRows=function(a,b){var c=this,d=new Mb(b.getContent(),function(a){return"tr"===a.getName()}).getAll();return h.map(d,function(b){return b.row=a.row,b.tableChilds=c._parseCols(a,b),a.row++,b})},a.prototype._parseCols=function(a,b){var c=new Mb(b.getContent(),function(a){var b=a.getName();return"td"===b||"th"===b}).getAll();return h.iteri(c,function(b,c){c.row=a.row,c.col=b}),c.length>a.maxCol&&(a.maxCol=c.length),c},a}(),Sb=function(){function a(a){Mb.call(this,a,function(a){return"li"===a.getName()})}return g.extend(a,Mb),a}(),Tb=function(){function a(a){Mb.call(this,a,function(a){var b=a.getName();return"dt"===b||"dd"===b})}return g.extend(a,Mb),a}(),Ub=function(){function a(a){Lb.call(this,a.getContent()),this.getAll(),this.tokens=this._parse(a),this.rewind()}return g.extend(a,Lb),a.prototype._parse=function(a){for(var b=[];this.hasNext();)b.push(this._parseRuby(a));return b},a.prototype._parseRuby=function(){for(var a=[],b=null;;){var c=this.get();if(null===c)break;if(E.isTag(c)&&"rt"===c.getName()){b=c;break}E.isText(c)&&a.push(c)}return new I(a,b)},a}(),Vb=function(){function a(a){this.context=a,this.generator=this._createGenerator()}return a.prototype={"yield":function(){return this.generator.yield()},hasNext:function(){return this.generator.hasNext()},getTitle:function(){return this.context.getTitle()},getMeta:function(a){return this.context.getMeta(a)},hasOutline:function(a){return this.generator.hasOutline(a)},getOutline:function(a){return this.generator.getOutline(a)},getOutlineTree:function(a){return this.generator.getOutlineTree(a)},getOutlineHtml:function(a){return this.generator.getOutlineHtml(a)},getAnchors:function(){return this.generator.getAnchors()},getAnchorPageNo:function(a){return this.generator.getAnchorPageNo(a)},_createGenerator:function(){for(;this.context.hasNextToken();){var a=this.context.getNextToken();switch(a.getName()){case"!doctype":this.context.setDocumentType(a);break;case"html":return this._createHtmlGenerator(a)}}return this._createHtmlGenerator(new D("<html>",this.context.getStreamSrc()))},_createHtmlGenerator:function(a){return new Wb(this.context.createBlockRoot(a,new Pb(a.getContentRaw())))}},a}(),Wb=function(){function a(a){this.context=a,this.generator=this._createGenerator()}return a.prototype={"yield":function(){return this.generator.yield()},hasNext:function(){return this.generator.hasNext()},hasOutline:function(a){return this.generator.hasOutline(a)},getOutline:function(a){return this.generator.getOutline(a)},getOutlineTree:function(a){return this.generator.getOutlineTree(a)},getOutlineHtml:function(a){return this.generator.getOutlineHtml(a)},getAnchors:function(){return this.generator.getAnchors()},getAnchorPageNo:function(a){return this.generator.getAnchorPageNo(a)},_createGenerator:function(){for(;this.context.hasNextToken();){var a=this.context.getNextToken();switch(a.getName()){case"head":this._parseHead(this.context.getHeader(),a.getContentRaw());break;case"body":return this._createBodyGenerator(a)}}return this._createBodyGenerator(new D("<body>",this.context.getStreamSrc()))},_createBodyGenerator:function(a){return new oc(this.context.createBlockRoot(a,new Lb(a.getContentRaw())))},_parseHead:function(a,b){for(var c=new Qb(b);c.hasNext();){var d=c.get();switch(d.getName()){case"title":a.setTitle(d.getContentRaw());break;case"meta":a.addMeta(d);break;case"link":a.addLink(d);break;case"style":a.addStyle(d);break;case"script":a.addScript(d)}}}},a}(),Xb=function(){function a(a){this.context=a}return a.prototype={hasNext:function(){return!1},_onReadyBox:function(){},_onCreateBox:function(){},_isTextLine:function(a){return a instanceof xb&&a.isTextLine()},_createStaticGenerator:function(a){switch(a.getName()){case"img":return new $b(this.context.createBlockRoot(a,null));case"ibox":return new Zb(this.context.createBlockRoot(a,null));case"div":return a.hasFlow()?new qc(this.context.createBlockRoot(a)):new Zb(this.context.createBlockRoot(a,null));default:return new qc(this.context.createBlockRoot(a))}},_createChildInlineTreeGenerator:function(a){switch(a.getName()){case"ruby":return new fc(this.context.createChildInlineRoot(a,new Ub(a)));case"a":return new hc(this.context.createChildInlineRoot(a));case"first-line":return new ic(this.context.createChildInlineRoot(a));default:return new ec(this.context.createChildInlineRoot(a))}},_createInlineBlockGenerator:function(a){return new jc(this.context.createInlineBlockRoot(a))},_createChildBlockTreeGenerator:function(a,b){switch(b.getName()){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return new nc(this.context.createBlockRoot(b));case"section":case"article":case"nav":case"aside":return new lc(this.context.createBlockRoot(b));case"details":case"blockquote":case"figure":case"fieldset":return new mc(this.context.createBlockRoot(b));case"table":return new tc(this.context.createBlockRoot(b,new Rb(b)));case"tbody":case"thead":case"tfoot":return new uc(this.context.createBlockRoot(b,new Nb(b.tableChilds)));case"dl":return new kc(this.context.createBlockRoot(b,new Tb(b.getContent())));case"ul":case"ol":return new vc(this.context.createBlockRoot(b,new Sb(b.getContent())));case"hr":return new _b(this.context.createBlockRoot(b,null));case"tr":return this._createTableRowGenerator(a,b);case"li":return this._createListItemGenerator(a,b);default:return new kc(this.context.createBlockRoot(b))}},_createTableRowGenerator:function(a,b){if(b.tableChilds&&a.partition){var c=b.tableChilds.length,d=a.partition.getPartition(c),e=this.context.createBlockRoot(b);return new rc(h.map(b.tableChilds,function(a){return new sc(e.createBlockRoot(a))}),d,e)}return new kc(this.context.createBlockRoot(b))},_createListItemGenerator:function(a,b){var c=a.listStyle||null;return null===c?new kc(this.context.createBlockRoot(b)):c.isInside()?this._createInsideListItemGenerator(a,b):this._createOutsideListItemGenerator(a,b)},_createInsideListItemGenerator:function(a,b){var c=a.listStyle.getMarkerHtml(b.order+1),d=p.tagWrap("span",c,{"class":"nehan-li-marker"})+n.space+b.getContent();return new kc(this.context.createBlockRoot(b,new Lb(d)))},_createOutsideListItemGenerator:function(a,b){var c=this.context.createBlockRoot(b),e=a.listStyle.getMarkerHtml(b.order+1),f=new D("<li-marker>",e),g=new D("<li-body>",b.getContent());return f.setCssAttr("font-family",d.markerFontFamily),new rc([new sc(c.createBlockRoot(f)),new sc(c.createBlockRoot(g))],a.partition,c)},_getBoxSize:function(a){return this.context.getMarkupStaticSize(a)||a.getRestSize()},_getLineSize:function(a){var b=a.getContentMeasure(),c=a.getContentExtent();return a.flow.getBoxSize(b,c)},_getBoxType:function(){return this.context.getMarkupName()},_setBoxClasses:function(a){h.iter(this.context.getMarkupClasses(),function(b){a.addClass(b)})},_setBoxStyle:function(a,b){this.context.markup&&yb.set(this.context.markup,a,b)},_createLine:function(a){var b=this._getLineSize(a);return d.createBox(b,a,{type:"text-line",markup:this.context.markup})},_createBox:function(a,b){var c=d.createBox(a,b,{type:this._getBoxType(),markup:this.context.markup});return this._onReadyBox(c,b),this._setBoxClasses(c,b),this._setBoxStyle(c,b),this._onCreateBox(c,b),c}},a}(),Yb=function(){function a(a){Xb.call(this,a)}return g.extend(a,Xb),a.prototype._getBoxSize=function(a){return this.context.getMarkupStaticSize(a)},a.prototype._createBox=function(a,b){var c=Xb.prototype._createBox.call(this,a,b);return c.sizing=eb.getByName("content-box"),c},a.prototype._findLineParent=function(a){for(var b=a.parent;b&&b.isTextLine();)b=b.parent;return b},a.prototype.yield=function(a){return a.isTextLine()&&(a=this._findLineParent(a)),this._yield(a)},a.prototype._yield=function(a){var b=this._getBoxSize(a),e=this._createBox(b,a);if(e.isDisplayNone())return s.IGNORE;this.context.markup.isPush()&&(e.backward=!0),this.context.markup.isPull()&&(e.forward=!0);var f=a.getRestSize();if(f.width-=e.getEdgeWidth(),f.height-=e.getEdgeHeight(),!f.isValid())return s.SINGLE_RETRY;if(f.canInclude(e.size))return e;var g=d.getStdPageSize(),h=e.size.resizeWithin(a.flow,f);return!g.canInclude(e.size)||h.percentFrom(e.size)>=c.minBlockScaleDownRate?(e.size=h,e):s.SINGLE_RETRY},a}(),Zb=function(){function a(a){Yb.call(this,a)}return g.extend(a,Yb),a.prototype._getBoxType=function(){return"ibox"},a.prototype._onCreateBox=function(a){a.content=this.context.markup.getContentRaw(),a.css.overflow="hidden"},a}(),$b=function(){function a(a){Yb.call(this,a)}return g.extend(a,Yb),a.prototype._onCreateBox=function(a){a.src=this.context.markup.getTagAttr("src")},a}(),_b=function(){function a(a){Xb.call(this,a)}return g.extend(a,Xb),a.prototype._getBoxSize=function(a){var b=a?a.getContentMeasure():d.getStdMeasure();return a.flow.getBoxSize(b,1)},a.prototype.yield=function(a){var b=this._getBoxSize(a),c=this._createBox(b,a);return c},a}(),ac=function(){function a(a,b){this.line=a,this.stream=b,this.lineStartPos=b.getPos(),this.textIndent=b.isHead()?a.textIndent||0:0,this.maxFontSize=0,this.maxExtent=0,this.maxMeasure=a.getContentMeasure()-this.textIndent,this.lineMeasure=a.getContentMeasure(),this.curMeasure=0,this.charCount=0,this.lineBreak=!1,this.lastToken=null,this.prevText=null,this.lastText=null,this.tokens=[],this._justified=!1}return a.prototype={restart:function(a){this.maxMeasure=a-this.textIndent,this.lineMeasure=a,this._justified=!1},isLineStartPos:function(){for(var a=this.line;null!==a.parent;){if(a.childMeasure>0)return!1;a=a.parent}return!0},skipBr:function(){this.stream.skipIf(function(a){return a&&E.isTag(a)&&"br"===a.getName()})},isJustified:function(){return this._justified},addElement:function(a){var b=this._getElementAdvance(a);if(!this._canContain(a,b)){if(b>0&&this.isLineStartPos(a))throw"LayoutError";throw this.skipBr(),"OverflowInline"}var c=this._getElementFontSize(a);c>this.maxFontSize&&(this.maxFontSize=c);var d=this._getElementExtent(a);if(d>this.maxExtent&&(this.maxExtent=d),a.getCharCount&&(this.charCount+=a.getCharCount()),b>0&&d>0&&(this.curMeasure+=b,this.line.setChildMeasure(this.curMeasure),this.tokens.push(a)),this.curMeasure===this.maxMeasure)throw this.skipBr(),"FinishInline"},setLineBreak:function(){this.lastText=null,this.lineBreak=!0},createLine:function(){if(0===this.curMeasure&&this.line.isTextLineRoot())return this._createEmptyLine();if(this._isOverWithoutLineBreak()){var a=this.tokens.length;if(this._justify(this.lastToken),this.tokens.length!==a){var b=this;this._justified=!0,this.curMeasure=h.fold(this.tokens,0,function(a,c){return a+b._getElementAdvance(c)})}}return this._createTextLine()},getNextToken:function(){var a=this.stream.get();return this.lastToken=a,a&&E.isText(a)&&this._setKerning(a),a},getRestMeasure:function(){return this.line.getContentMeasure()-this.curMeasure},getFontSize:function(){return this.line.getFontSize()},getMaxMeasure:function(){return this.maxMeasure},getMaxFontSize:function(){return this.maxFontSize},getMaxExtent:function(){return this.maxExtent},_getElementExtent:function(a){return E.isText(a)?(E.isChar(a)||E.isTcy(a))&&this.line.textEmpha?this.line.textEmpha.getExtent(this.line.getFontSize()):this.line.getFontSize():a instanceof I?a.getExtent(this.line.getFontSize()):a.getBoxExtent(this.line.flow)},_getElementFontSize:function(a){return a instanceof xb?a.getFontSize():this.line.getFontSize()},_getElementAdvance:function(a){return E.isText(a)?a.getAdvance(this.line.flow,this.line.letterSpacing||0):a instanceof I?a.getAdvance(this.line.flow):a.getBoxMeasure(this.line.flow)},_isJustifyElement:function(a){return a instanceof F?!0:a instanceof I&&this.curMeasure>0?!0:!1},_canContain:function(a,b){return this.line.isJustifyTarget()?this.curMeasure+b+this.line.getFontSize()<=this.maxMeasure:this.curMeasure+b<=this.maxMeasure},_isOverWithoutLineBreak:function(){return!this.lineBreak&&this.tokens.length>0},_isLineStart:function(){return this.stream.getPos()==this.lineStartPos},_setKerning:function(a){if(this.prevText=this.lastText,this.lastText=a,E.isChar(a))if(a.isKakkoStart())this._setKerningStart(a,this.prevText);else if(a.isKakkoEnd()||a.isKutenTouten()){var b=this.stream.findTextNext(a.pos);this._setKerningEnd(a,b)}},_setKerningStart:function(a,b){var c=this._getTextSpaceStart(a,b);c>0&&(a.spaceRateStart=c)},_setKerningEnd:function(a,b){var c=this._getTextSpaceEnd(a,b);c>0&&(a.spaceRateEnd=c)},_getTextSpaceStart:function(a,b){return null===b?.5:E.isChar(b)&&b.isKakkoStart()?0:.5},_getTextSpaceEnd:function(a,b){return null===b?.5:E.isChar(b)&&(b.isKakkoEnd()||b.isKutenTouten())?0:.5},_justify:function(a){var b=a,c=a?this.stream.findTextPrev(a.pos):null,d=this.stream.getPos();b&&E.isChar(b)&&b.isHeadNg()&&(this._justifyHead(b),this.stream.getPos()!=d&&(c=this.stream.findTextPrev(),this.skipBr())),c&&b&&c.pos<b.pos&&E.isText(b)&&E.isChar(c)&&c.isTailNg()&&this._justifyTail(c)},_justifyHead:function(a){var b=0;if(this.stream.iterWhile(a.pos,function(a,c){return E.isChar(c)&&c.isHeadNg()?(b++,!0):!1}),!(0>=b)){if(1===b)return this.tokens.push(a),void this.stream.setPos(a.pos+1);var c=-1;if(this.stream.revIterWhile(a.pos,function(a,b){return a<=this.lineStartPos?!1:E.isChar(b)&&!b.isHeadNg()?(c=a,!1):!0}),!(0>c)){for(var d=a.pos;d>c;)this.tokens.pop(),d--;this.stream.setPos(c)}}},_justifyTail:function(a){var b=0;if(this.stream.revIterWhile(a.pos,function(a,c){return E.isChar(c)&&c.isTailNg()?(b++,!0):!1}),!(0>=b)){if(1===b)return this.tokens.pop(),void this.stream.setPos(a.pos);var c=-1;if(this.stream.revIterWhile(a.pos,function(a,b){return a<=this.lineStartPos?!1:E.isChar(b)&&!b.isTailNg()?(c=a,!1):!0}),!(0>c)){for(var d=a.pos;d>c;)this.tokens.pop(),d--;this.stream.setPos(c+1)}}},_createEmptyLine:function(){return this.line.size=this.line.flow.getBoxSize(this.lineMeasure,this.line.getFontSize()),this.line.setInlineElements([],this.lineMeasure),this.line},_createTextLine:function(){var a=Math.round(this.maxFontSize*(this.line.lineRate-1)),b=this.maxFontSize+a;return this.maxExtent=Math.max(this.maxExtent,b),this.line.size=this.line.flow.getBoxSize(this.lineMeasure,this.maxExtent),this.line.charCount=this.charCount,this.line.setInlineElements(this.tokens,this.curMeasure),this.line.textIndent=this.textIndent,this.line}},a}(),bc=function(){function a(a){this.page=a,this.curExtent=0,this.maxExtent=a.getContentExtent()}return a.prototype={getRestExtent:function(){return this.maxExtent-this.curExtent},addElement:function(a){var b=a.isPositionAbsolute(),c=a.getBoxExtent(this.page.flow);if(a instanceof xb&&!a.isTextLine()&&0>=c&&(a.pageBreakAfter=!0),!b&&this.curExtent+c>this.maxExtent)throw"OverflowBlock";if(this.page.addChildBlock(a),b||(this.curExtent+=c),!b&&this.curExtent===this.maxExtent)throw"FinishBlock"}},a}(),cc=function(){function a(a){Xb.call(this,a),this.generator=null}return g.extend(a,Xb),a.prototype.hasNext=function(){return this._terminate?!1:this.generator&&this.generator.hasNext()?!0:this.context.hasNextToken()},a.prototype.getCurGenerator=function(){return this.generator&&this.generator.hasNext()?this.generator:null},a.prototype._onCompleteBlock=function(){},a.prototype._onLastBlock=function(){},a.prototype.yield=function(a,b){var c,d;return d=b||this._getBoxSize(a),c=this._createBox(d,a),c.isDisplayNone()?(this._terminate=!0,s.IGNORE):this._yieldBlocksTo(c)},a.prototype._yieldBlocksTo=function(a){for(this.context.createBlockContext(a),this.generator&&(this.generator.context.blockContext=this.context.blockContext);;){var b=this._yieldBlockElement(a);if("number"==typeof b){if(b==s.IGNORE)continue;if(b==s.SINGLE_RETRY){this.context.pushBackToken(),a.breakAfter=!0;break}if(b==s.PAGE_BREAK){a.breakAfter=!0;break}break}try{var c=b.breakBefore||!1,d=b.breakAfter||!1;if(c){a.breakAfter=!0;break}if(b.logicalFloat&&(a.logicalFloat=b.logicalFloat,b=this._yieldFloatedBlock(a,b)),this.context.addBlockElement(b),d){a.breakAfter=!0;break}}catch(e){"FinishBlock"===e&&(a.breakAfter=!0);break}}return this.context.isFirstLocalPage()||a.clearBorderBefore(),this.hasNext()?a.clearBorderAfter():this._onLastBlock(a),this._onCompleteBlock(a),a.getBoxExtent()>0&&this.context.stepLocalPageNo(),a},a.prototype._yieldBlockElement=function(a){if(this.generator&&this.generator.hasNext())return this.generator.yield(a);this.generator=null;var b=this.context.getNextToken();if(null===b)return s.BUFFER_END;var c=E.isTag(b);if(E.isChar(b)&&b.isNewLineChar())return s.IGNORE;if(c&&b.isPageBreakTag())return s.PAGE_BREAK;if(c&&b.isMetaTag())return s.IGNORE;if(c&&this.context.inheritMarkup(b),c&&b.hasStaticSize()&&b.isBlock())return this.generator=this._createStaticGenerator(b),this.generator.yield(a);if(E.isText(b)||E.isInline(b))return this.context.pushBackToken(),this.generator=new dc(this.context.createInlineRoot(this.context.markup,this.context.stream)),this.generator.yield(a);if(b.isInline()||b.isInlineBlock())return this.generator=this._createChildInlineTreeGenerator(b),this.generator.yield(a);if(b.hasFlow()&&b.getCssAttr("flow")!=a.getFlowName()){var d=a.getRestSize(),e=new qc(this.context.createBlockRoot(b));return e.yield(a,d)}return this.generator=this._createChildBlockTreeGenerator(a,b),this.generator.yield(a)},a.prototype._yieldFloatedBlock=function(a,b){if(a.getContentMeasure()<=b.getBoxMeasure())return b;var c=new pc(this.context.createFloatedRoot(),b),d=c.yield(a);return this.generator=c.getCurGenerator(),this.generator&&(this.generator.context.blockContext=this.context.blockContext),d},a}(),dc=function(){function a(a){cc.call(this,a),this.cachedLine=null,this._prevStart=0,this._retry=0}return g.extend(a,cc),a.prototype.getParentPos=function(){return this.context.markup.pos},a.prototype.hasNext=function(){return this._terminate?!1:this.cachedElement||this.cachedLine?!0:cc.prototype.hasNext.call(this)},a.prototype._onCompleteLine=function(a){a.setMaxExtent(this.context.getInlineMaxExtent()),a.setMaxFontSize(this.context.getInlineMaxFontSize())},a.prototype._isEnableElement=function(a){return a instanceof xb?a.getContentExtent()>0&&a.getContentMeasure()>0:!0},a.prototype.yield=function(a){if(this.cachedLine)return this._yieldCachedLine(a);var b=this._createLine(a);return b.isDisplayNone()?(this._terminate=!0,s.IGNORE):(this.context.createInlineContext(b),this._yieldInlinesTo(b))},a.prototype._yieldCachedElement=function(){var a=this.cachedElement;return this.cachedElement=null,a},a.prototype._yieldCachedLine=function(a){var b=this.cachedLine,c=b.parent.getContentMeasure(),d=a.getContentMeasure();return b.parent=a,this.cachedLine=null,c==d?b:(this.context.restartInlineContext(a.getContentMeasure()),this._yieldInlinesTo(b))},a.prototype._yieldInlinesTo=function(a){var b=!1,d=this.context.getStreamPos();if(d===this._prevStart){if(this._retry++,this._retry>c.maxRollbackCount){{this.context.getNextToken()}this._retry=0}}else this._retry=0,this._prevStart=d;for(;;){var e=this._yieldInlineElement(a);if("number"==typeof e){if(e==s.IGNORE)continue;this.context.setLineBreak(),e===s.FORCE_TERMINATE?this.context.pushBackToken():e==s.SINGLE_RETRY&&(this.context.pushBackToken(),b=!0);break}try{if(b=e.endAfter||!1,e.logicalFloat)return e;if(this.context.addInlineElement(e),b)break}catch(f){"OverflowInline"===f&&(b=!0,this.cachedElement=this._isEnableElement(e)?e:null);break}if(e instanceof G&&e.isDevided()){this.context.pushBackToken();break}}return line=this.context.createLine(),b&&(line.endAfter=!0),this._onCompleteLine(line),this.context.isJustified()&&(this.cachedElement=null),this.context.canContainExtent(line.getBoxExtent(a.flow))?line:(this.cachedLine=line,s.PAGE_BREAK)},a.prototype._yieldInlineElement=function(a){if(this.cachedElement)return this._yieldCachedElement(a);if(this.generator&&this.generator.hasNext())return this.generator.yield(a);this.generator=null;var b=this.context.getInlineNextToken();return this._yieldInlineToken(a,b)},a.prototype._yieldInlineToken=function(a,b){if(null===b)return s.BUFFER_END;if(b instanceof I)return b;if(E.isChar(b)&&b.isNewLineChar())return a.isPreLine()?s.LINE_BREAK:s.IGNORE;if(E.isText(b))return this._yieldText(a,b);if(b.isMetaTag())return s.IGNORE;var c=b.getName();return"br"===c?s.LINE_BREAK:(this.context.inheritMarkup(b),b.isBlock()?(this._terminate=!0,s.FORCE_TERMINATE):b.hasStaticSize()?(this.generator=this._createStaticGenerator(b),this.generator.yield(a)):b.isInlineBlock()?(this.generator=this._createInlineBlockGenerator(b),this.generator.yield(a)):b.isSingleTag()?b:(this.generator=this._createChildInlineTreeGenerator(b),this.generator.yield(a)))},a.prototype._yieldText=function(a,b){switch("first-line"!==this.context.getMarkupName()&&b.hasMetrics()||b.setMetrics(a.flow,a.font),b._type){case"char":case"tcy":return b;case"word":return this._yieldWord(a,b)}},a.prototype._yieldWord=function(a,b){var c=b.getAdvance(a.flow,a.letterSpacing||0),d=this.context.getInlineMaxMeasure();if(d>=c)return b.setDevided(!1),b;var e=b.cutMeasure(a.getFontSize(),d);return e.setMetrics(a.flow,a.font),b.setMetrics(a.flow,a.font),e},a}(),ec=function(){function a(a){dc.call(this,a)}return g.extend(a,dc),a.prototype._createLine=function(a){var b=dc.prototype._createLine.call(this,a);return this._setBoxStyle(b,a),b},a.prototype._getLineSize=function(a){var b=a.getContentMeasure();this.context.isFirstLocalLine()&&(b-=a.childMeasure);
var c=a.getContentExtent();return a.flow.getBoxSize(b,c)},a.prototype._onCompleteLine=function(a){a.shortenMeasure()},a}(),fc=function(){function a(a){ec.call(this,a)}return g.extend(a,ec),a.prototype._yieldInlineElement=function(a){var b=ec.prototype._yieldInlineElement.call(this,a);return"number"==typeof b?b:(b.hasMetrics()||b.setMetrics(a.flow,a.font,a.letterSpacing||0),b)},a}(),gc=function(){function a(a){ec.call(this,a)}return g.extend(a,ec),a.prototype._getLineSize=function(a){var b=a.getContentMeasure(),c=a.getContentExtent();return a.flow.getBoxSize(b,c)},a}(),hc=function(){function a(a){ec.call(this,a);var b=this.context.markup.getTagAttr("name");b&&this.context.setAnchor(b)}return g.extend(a,ec),a}(),ic=function(){function a(a){ec.call(this,a)}return g.extend(a,ec),a.prototype._createLine=function(a){return this.context.isStreamHead()||(this.context.markup.cssAttrStatic={}),ec.prototype._createLine.call(this,a)},a}(),jc=function(){function a(a){cc.call(this,a)}return g.extend(a,cc),a.prototype._getBoxType=function(){return"inline-block"},a}(),kc=function(){function a(a){cc.call(this,a)}return g.extend(a,cc),a.prototype._onCompleteBlock=function(a){a.shortenExtent(a.getParentFlow())},a}(),lc=function(){function a(a){kc.call(this,a),this.context.logStartSection()}return g.extend(a,kc),a.prototype._onLastBlock=function(){this.context.logEndSection()},a}(),mc=function(){function a(a){kc.call(this,a),this.context.startSectionRoot()}return g.extend(a,kc),a.prototype.hasOutline=function(a){var b=this.getOutlineBuffer(a);return b.isEmpty()===!1},a.prototype.getOutlineBuffer=function(a){var b=a||this.context.getMarkupName();return this.context.getOutlineBuffer(b)},a.prototype.getOutlineTree=function(a){var b=this.getOutlineBuffer(a),c=new Fb(b).getTree();return c},a.prototype.getAnchors=function(){return this.context.getAnchors()},a.prototype.getAnchorPageNo=function(a){return this.context.getAnchorPageNo(a)},a.prototype.setAnchor=function(a,b){this.context.setAnchor(a,b)},a.prototype._onLastBlock=function(a){this.context.endSectionRoot(),kc.prototype._onLastBlock.call(this,a)},a}(),nc=function(){function a(a){kc.call(this,a)}return g.extend(a,kc),a.prototype._onCompleteBlock=function(a){kc.prototype._onCompleteBlock.call(this,a);var b=this.context.logSectionHeader();a.id=o.addNehanHeaderPrefix(b)},a.prototype._onCreateBox=function(a){a.addClass("nehan-header")},a}(),oc=function(){function a(a){mc.call(this,a)}return g.extend(a,mc),a.prototype._getBoxSize=function(){return d.getStdPageSize()},a.prototype._createBox=function(a){var b=d.createRootBox(a);return this._setBoxStyle(b,null),b.percent=this.context.getSeekPercent(),b.seekPos=this.context.getSeekPos(),b.pageNo=this.context.getPageNo(),b.charPos=this.context.getCharPos(),b},a.prototype._onCompleteBlock=function(a){this.context.stepPageNo(),this.context.addCharPos(a.getCharCount())},a}(),pc=function(){function a(a,b){cc.call(this,a),this.floatedBox=b}return g.extend(a,cc),a.prototype.yield=function(a){var b=this._getFloatedWrapBox(a,this.floatedBox),c=this._getFloatedRestBox(a,b,this.floatedBox);return this._yieldBlocksTo(c),"start"===this.floatedBox.logicalFloat?(b.addChildBlock(this.floatedBox),b.addChildBlock(c)):(b.addChildBlock(c),b.addChildBlock(this.floatedBox)),b},a.prototype._getFloatedRestBox=function(a,b,c){var e=a.getContentMeasure()-c.getBoxMeasure(a.flow),f=c.getBoxExtent(a.flow),g=a.flow.getBoxSize(e,f),h=d.createBox(g,b,{type:"box"});return h.setFlow(a.flow),h},a.prototype._getFloatedWrapBox=function(a,b){var c=a.getContentMeasure(),e=b.getBoxExtent(a.flow),f=a.flow.getBoxSize(c,e),g=d.createBox(f,a,{type:"box"}),h=a.getFloatedWrapFlow();return g.setParent(a,!1),g.setFlow(h),b.setParent(g,!0),g},a}(),qc=function(){function a(a){cc.call(this,a)}return g.extend(a,cc),a.prototype.hasNext=function(){return!1},a.prototype.yield=function(a){var b=this._getBoxSize(a),c=d.createBox(b,a,{type:"div"}),e=cc.prototype.yield.call(this,c);return"number"==typeof e?e:(c.addChildBlock(e),c.logicalFloat=e.logicalFloat,c)},a}(),rc=function(){function a(a,b,c){kc.call(this,c),this.generators=a,this.partition=b}return g.extend(a,kc),a.prototype.hasNext=function(){return h.exists(this.generators,function(a){return a.hasNext()})},a.prototype.yield=function(a){var b=a.getRestSize(),c=this._createBox(b,a),d=a.getParallelFlow(),e=a.flow;return c.setFlow(d),this._yieldChildsTo(c,e,this.partition)},a.prototype._yieldChildsTo=function(a,b,c){var d=a.getRestContentExtent(),e=h.mapi(this.generators,function(e,f){var g=c.getSize(e),h=b.getBoxSize(g,d),i=f.yield(a,h);return i.breakBefore?(a.breakAfter=!0,null):(i.breakAfter&&(a.breakAfter=!0),i)}),f=h.maxobj(e,function(a){return a instanceof xb?a.getContentExtent():0}),g=f?f.getContentExtent():0,i=f?f.getBoxExtent():0;return a.setContentExtent(b,i),h.iter(e,function(c){c&&c instanceof xb&&(c.setContentExtent(b,g),a.addParaChildBlock(c))}),a},a}(),sc=function(){function a(a){kc.call(this,a)}return g.extend(a,kc),a.prototype._setBoxEdge=function(){},a.prototype._onReadyBox=function(a,b){var c=b.getParallelFlipFlow();a.setFlow(c)},a}(),tc=function(){function a(a){kc.call(this,a)}return g.extend(a,kc),a.prototype._onReadyBox=function(a){"collapse"===this.context.markup.getCssAttr("border-collapse")&&"undefined"==typeof this.collapse&&(Kb.set(this.context.markup,a),this.collapse=!0)},a.prototype._onCreateBox=function(a){a.partition=this.context.stream.getPartition(a)},a}(),uc=function(){function a(a){kc.call(this,a)}return g.extend(a,kc),a.prototype._onCreateBox=function(a,b){a.partition=b.partition},a}(),vc=function(){function a(a){kc.call(this,a)}return g.extend(a,kc),a.prototype._onCreateBox=function(a,b){var c=this.context.getStreamTokenCount(),d=this.context.markup.getCssAttr("list-style-type","none"),e=this.context.markup.getCssAttr("list-style-position","outside"),f=this.context.markup.getCssAttr("list-style-image","none"),g=this.context.markup.getCssAttr("list-style-format"),h=new S({type:d,position:e,image:f,format:g}),i=h.getMarkerAdvance(b.flow,b.getFontSize(),c);a.listStyle=h,a.partition=new ob([i,a.getContentMeasure()-i])},a}(),wc=(function(){function a(a,b,c){var d=b.listStyle.getMarkerHtml(a.order+1),e=p.tagWrap("span",d,{"class":"nehan-li-marker"});a.contentRaw=e+n.space+a.getContentRaw(),kc.call(this,a,c)}return g.extend(a,kc),a}(),function(){function a(a,b,c){var d=b.listStyle.getMarkerHtml(a.order+1),e=new D("<li-marker>",d),f=new D("<li-body>",a.getContent());rc.call(this,[new sc(e,c),new sc(f,c)],a,c,b.partition)}return g.extend(a,rc),a}(),function(){function a(a){r.merge(this,{html:"",groupLength:1,seekPos:0,pageNo:0,charPos:0,charCount:0,percent:0},a)}return a.prototype={isGroup:function(){return this.groupLength>1},getPercent:function(){return this.percent},getPageNo:function(){return this.pageNo},getGroupCount:function(){return this.groupLength},getPageCount:function(){return this.isGroup()&&this.html instanceof Array?this.html.length:1},getHtml:function(a){return this.isGroup()?this.html[a]||"":this.html}},a}()),xc=function(){function a(){this.blockEvaluator=new yc}return a.prototype={evaluate:function(a){return new wc({html:this.blockEvaluator.evaluate(a),percent:a.percent,seekPos:a.seekPos,pageNo:a.pageNo,charPos:a.charPos,charCount:a.charCount})}},a}(),yc=function(){function a(){this.inlineEvaluatorH=new Bc(this),this.inlineEvaluatorV=new Ac(this)}return a.prototype={evaluate:function(a){switch(a._type){case"br":return this.evalBreak(a);case"hr":return this.evalHr(a);case"ibox":return this.evalInlineBox(a);case"ipage":return this.evalInlinePage(a);case"img":return this.evalImage(a);case"table":return this.evalTable(a);case"text-line":return this.evalTextLine(a);default:return this.evalBox(a)}},evalBox:function(a){var b=a.getMarkup();return p.tagWrap("div",this.evalBoxChilds(a.getChilds()),r.copy({id:a.id||null,style:o.toString(a.getCssBlock()),"class":a.getCssClasses()},b?b.getDatasetAttrsRaw():{}))},evalBoxChilds:function(a){var b=this;return h.fold(a,"",function(a,c){return[a,b.evaluate(c)].join("\n")})},evalTextLine:function(a){return a.isTextVertical()?this.inlineEvaluatorV.evaluate(a):this.inlineEvaluatorH.evaluate(a)},evalInlineBox:function(a){var b=c.iboxEnable?a.content:"";return p.tagWrap("div",b,{style:o.toString(a.getCssBlock()),"class":a.getCssClasses()})},evalHr:function(a){return this.evalInlineBox(a)},evalBreak:function(a){return this.evalInlineBox(a)},evalImage:function(a){var b=this.evalImageContent(a);return p.tagWrap("div",b,{style:o.toString(a.getCssBlock()),"class":a.getCssClasses()})},evalImageContent:function(a){var b=a.getMarkup();return p.tagSingle("img",r.copy({src:a.src,title:a.getMarkup().getTagAttr("title")||"",width:a.getContentWidth(),height:a.getContentHeight()},b?b.getDatasetAttrsRaw():{}))},evalInlinePage:function(a){return this.evalBox(a)},evalTable:function(a){return this.evalBox(a)}},a}(),zc=function(){function a(a){this.parentEvaluator=a}return a.prototype={evaluate:function(){throw"InlineTreeEvaluator::evaluate not implemented"},evalTextLineBody:function(a,b){var c=this,d=h.fold(b,"",function(b,d){return b+c.evalInlineElement(a,d)});return a.isLinkLine()?this.evalLinkLine(a,d):d},evalLinkLine:function(a,b){var c={},d=a.getMarkup();c.href=d.getTagAttr("href","#");var e=d.getTagAttr("name");e&&(a.addClass("nehan-anchor"),c.name=e);var f=d.getTagAttr("title");f&&(c.title=f);var g=d.getTagAttr("target");return g&&(c.target=g),c.href.indexOf("#")>=0&&a.addClass("nehan-anchor-link"),c["class"]=a.getCssClasses(),p.tagWrap("a",b,c)},evalInlineElement:function(a,b){return"text-line"===b._type?this.evaluate(b):b instanceof I?this.evalRuby(a,b):E.isText(b)?this.evalText(a,b):b instanceof xb?this.evalInlineBox(a,b):""},evalText:function(a,b){switch(b._type){case"word":return this.evalWord(a,b);case"tcy":var c=this.evalTcy(a,b);return a.textEmpha?this.evalEmpha(a,b,c):c;case"char":var d=this.evalChar(a,b);return a.textEmpha?this.evalEmpha(a,b,d):d;default:return""}},evalInlineBox:function(){throw"not implemented: evalInlineBox"},evalWord:function(){throw"not implemented: evalWord"},evalTcy:function(){throw"not implemented: evalTcy"},evalChar:function(){throw"not implemented: evalChar"}},a}(),Ac=function(){function a(a){zc.call(this,a)}return g.extend(a,zc),a.prototype.evaluate=function(a){var b=a.getMarkup();return p.tagWrap("div",this.evalTextLineBody(a,a.getChilds()),r.copy({style:o.toString(a.getCssInline()),"class":a.getCssClasses()},b?b.getDatasetAttrsRaw():{}))},a.prototype.evalRuby=function(a,b){var c=this.evalRb(a,b)+this.evalRt(a,b);return p.tagWrap("div",c,{style:o.toString(b.getCssVertRuby(a)),"class":"nehan-ruby-body"})},a.prototype.evalRb=function(a,b){var c=this.evalTextLineBody(a,b.getRbs());return p.tagWrap("div",c,{style:o.toString(b.getCssVertRb(a)),"class":"nehan-rb"})},a.prototype.evalRt=function(a,b){var c=new gc(new Ib({markup:b.rt,stream:new Lb(b.rt.getContentRaw())})),d=c.yield(a),e=b.getCssVertRt(a);for(var f in e)d.setCss(f,e[f]);return this.evaluate(d)},a.prototype.evalWord=function(a,b){return e.isTransformEnable?e.isTrident?this.evalWordTransformTrident(a,b):this.evalWordTransform(a,b):e.isIE?this.evalWordIE(a,b):""},a.prototype.evalWordTransform=function(a,b){var c=p.tagWrap("div",b.data,{"class":"nehan-rotate-90",style:o.toString(b.getCssVertTransBody(a))});return p.tagWrap("div",c,{style:o.toString(b.getCssVertTrans(a))})},a.prototype.evalWordTransformTrident=function(a,b){var c=p.tagWrap("div",b.data,{style:o.toString(b.getCssVertTransBodyTrident(a))});return p.tagWrap("div",c,{style:o.toString(b.getCssVertTrans(a))})},a.prototype.evalWordIE=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-vert-ie",style:o.toString(b.getCssVertTransIE(a))})+n.clearFix},a.prototype.evalRotateChar=function(a,b){return e.isTransformEnable?this.evalRotateCharTransform(a,b):e.isIE?this.evalRotateCharIE(a,b):this.evalCharWithBr(a,b)},a.prototype.evalRotateCharTransform=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-rotate-90"})},a.prototype.evalRotateCharIE=function(a,b){return p.tagWrap("div",b.data,{style:o.toString(b.getCssVertRotateCharIE(a)),"class":"nehan-vert-ie"})+n.clearFix},a.prototype.evalTcy=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-tcy"})},a.prototype.evalChar=function(a,b){return b.isImgChar()?b.isVertGlyphEnable()?this.evalVerticalGlyph(a,b):this.evalImgChar(a,b):b.isHalfSpaceChar(b)?this.evalHalfSpaceChar(a,b):b.isCnvChar()?this.evalCnvChar(a,b):b.isRotateChar()?this.evalRotateChar(a,b):b.isSmallKana()?this.evalSmallKana(a,b):b.isPaddingEnable()?this.evalPaddingChar(a,b):a.letterSpacing?this.evalCharLetterSpacing(a,b):this.evalCharWithBr(a,b)},a.prototype.evalCharWithBr=function(a,b){return b.data+"<br />"},a.prototype.evalCharLetterSpacing=function(a,b){return p.tagWrap("div",b.data,{style:o.toString(b.getCssVertLetterSpacing(a))})},a.prototype.evalEmpha=function(a,b,c){c=c.replace("<br />","");var d=p.tagWrap("span",c,{"class":"nehan-empha-src",style:o.toString(b.getCssVertEmphaSrc(a))}),e=p.tagWrap("span",a.textEmpha.getText(),{"class":"nehan-empha-text",style:o.toString(b.getCssVertEmphaText(a))});return p.tagWrap("div",d+e,{"class":"nehan-empha-wrap",style:o.toString(a.textEmpha.getCssVertEmphaWrap(a,b))})},a.prototype.evalPaddingChar=function(a,b){return p.tagWrap("div",b.data,{style:o.toString(b.getCssPadding(a))})},a.prototype.evalImgChar=function(a,b){var c=a.color||new K(d.fontColor),e=c.getRgb(),f=M.getColor(e).toUpperCase();return p.tagSingle("img",{"class":"nehan-img-char",src:b.getImgSrc(f),style:o.toString(b.getCssVertImgChar(a))})+n.clearFix},a.prototype.evalVerticalGlyph=function(a,b){return p.tagWrap("div",b.data,{"class":"nehan-vert-glyph",style:o.toString(b.getCssVertGlyph(a))})},a.prototype.evalCnvChar=function(a,b){return b.cnv+"<br />"},a.prototype.evalSmallKana=function(a,b){var c=a.textEmpha?"span":"div";return p.tagWrap(c,b.data,{style:o.toString(b.getCssVertSmallKana())})},a.prototype.evalHalfSpaceChar=function(a,b){{var c=a.getFontSize();Math.round(c/2)}return p.tagWrap("div","&nbsp;",{style:o.toString(b.getCssVertHalfSpaceChar(a))})},a.prototype.evalInlineBox=function(a,b){var c="img"===b._type?this.parentEvaluator.evalImageContent(b):b.content;return p.tagWrap("div",c,{style:o.toString(b.getCssVertInlineBox())})},a}(),Bc=function(){function a(a){zc.call(this,a)}return g.extend(a,zc),a.prototype.evaluate=function(a,b){var c=a.isInlineOfInline()?"span":"div",d=a.getMarkup(),e=r.copy({style:o.toString(a.getCssInline()),"class":a.getCssClasses()},d?d.getDatasetAttrsRaw():{});return p.tagWrap(c,this.evalTextLineBody(a,a.getChilds(),b),e)},a.prototype.evalRuby=function(a,b,c){var d=this.evalRt(a,b,c)+this.evalRb(a,b,c);return p.tagWrap("span",d,{style:o.toString(b.getCssHoriRuby(a)),"class":"nehan-ruby"})},a.prototype.evalRb=function(a,b,c){var d=this.evalTextLineBody(a,b.getRbs(),c);return p.tagWrap("div",d,{style:o.toString(b.getCssHoriRb(a)),"class":"nehan-rb"})},a.prototype.evalRt=function(a,b){return p.tagWrap("div",b.getRtString(),{style:o.toString(b.getCssHoriRt(a)),"class":"nehan-rt"})},a.prototype.evalWord=function(a,b){return b.data},a.prototype.evalTcy=function(a,b){return b.data},a.prototype.evalChar=function(a,b,c){return b.isHalfSpaceChar()?b.cnv:b.isKerningChar()?this.evalKerningChar(a,b,c):b.data},a.prototype.evalEmpha=function(a,b,c){var d=p.tagWrap("div",c,{style:o.toString(b.getCssHoriEmphaSrc(a))}),e=p.tagWrap("div",a.textEmpha.getText(),{style:o.toString(b.getCssHoriEmphaText(a))});return p.tagWrap("span",e+d,{style:o.toString(a.textEmpha.getCssHoriEmphaWrap(a,b))})},a.prototype.evalKerningChar=function(a,b){var c=b.getCssPadding(a);return b.isKakkoStart()?(c["margin-left"]="-0.5em",p.tagWrap("span",b.data,{style:o.toString(c),"class":"nehan-char-kakko-start"})):b.isKakkoEnd()?(c["margin-right"]="-0.5em",p.tagWrap("span",b.data,{style:o.toString(c),"class":"nehan-char-kakko-end"})):b.isKutenTouten()?(c["margin-right"]="-0.5em",p.tagWrap("span",b.data,{style:o.toString(c),"class":"nehan-char-kuto"})):b.data},a.prototype.evalPaddingChar=function(a,b){return p.tagWrap("span",b.data,{style:o.toString(b.getCssPadding(a))})},a.prototype.evalInlineBox=function(a,b){return b.setDisplay("inline-block"),this.parentEvaluator.evaluate(b)},a}(),Cc=function(){function a(){this.evaluator=new xc}return a.prototype={evaluate:function(a){var b=this,c=0,d=[],e=h.map(a.getPages(),function(a){var e=b.evaluator.evaluate(a);return c+=e.charCount,d.push(e.html),e}),f=e[0];return new wc({html:d,groupLength:a.getSize(),percent:f.percent,seekPos:f.seekPos,pageNo:f.pageNo,charPos:f.charPos,charCount:c})}},a}(),Dc=function(){function a(a){this.text=this._createSource(a),this.generator=this._createGenerator(this.text),this.evaluator=this._createEvaluator(),this.buffer=[],this._timeStart=null,this._timeElapsed=null,this._seekPageNo=0,this._seekPercent=0,this._seekPos=0}return a.prototype={hasPage:function(a){return"undefined"!=typeof this.buffer[a]},hasNext:function(){return this.generator.hasNext()},hasOutline:function(a){return this.generator.hasOutline(a)},getNext:function(){if(!this.hasNext())return null;var a=this._seekPageNo;if(!this.hasPage(a)){var b=this._yield();this._addBuffer(b),this._seekPageNo++,this._seekPercent=b.percent,this._seekPos=b.seekPos}return this.get(a)},get:function(a){var b=this.buffer[a];if(b instanceof wc)return b;var c=this.evaluator.evaluate(b);return this.buffer[a]=c,c},getPageCount:function(){return this.buffer.length},getGroupPageNo:function(a){return a},getOutlineTree:function(a){return this.generator.getOutlineTree(a||"body")},getOutlineNode:function(a,b){var c=this.getOutlineTree(a),d=new Gb(c,b||{});return d.outputNode()},getAnchors:function(){return this.generator.getAnchors()},getAnchorPageNo:function(a){return this.generator.getAnchorPageNo(a)},getSeekPageResult:function(){return this.get(this._seekPageNo)},getSeekPageNo:function(){return this._seekPageNo},getSeekPercent:function(){return this._seekPercent},getSeekPos:function(){return this._seekPos},setAnchor:function(a,b){this.generator.setAnchor(a,b)},getTimeElapsed:function(){return this._timeElapsed},syncGet:function(){for(this._setTimeStart();this.generator.hasNext();)this.getNext();return this._setTimeElapsed()},asyncGet:function(a){r.merge(this,{onComplete:function(){},onProgress:function(){},onError:function(){}},a||{}),this._setTimeStart(),this._asyncGet(a.wait||0)},_yield:function(){return this.generator.yield()},_setTimeStart:function(){return this._timeStart=(new Date).getTime(),this._timeStart},_setTimeElapsed:function(){return this._timeElapsed=(new Date).getTime()-this._timeStart,this._timeElapsed},_asyncGet:function(a){if(!this.generator.hasNext()){var b=this._setTimeElapsed();return void this.onComplete(b)}var c=this,d=this._yield();this._addBuffer(d),this.onProgress(this),this._seekPageNo++,this._seekPercent=d.percent,this._seekPos=d.seekPos,m(function(){c._asyncGet(a)})},_addBuffer:function(a){this.buffer.push(a)},_createSource:function(a){return a.replace(/(<\/[a-zA-Z0-9\-]+>)[\s]+</g,"$1<").replace(/\t/g,"").replace(/<!--[\s\S]*?-->/g,"").replace(/<rp>[^<]*<\/rp>/gi,"").replace(/<rb>/gi,"").replace(/<\/rb>/gi,"").replace(/<rt><\/rt>/gi,"")},_createGenerator:function(a){return new Vb(new Ib({stream:new Ob(a)}))},_createEvaluator:function(){return new xc}},a}(),Ec=function(){function a(a){this.trees=[],this.size=a}return a.prototype={add:function(a){if(this.isComplete())throw"overflow";this.trees.push(a)},commit:function(){var a=this.getFirst();this.percent=a.percent,this.seekPos=a.seekPos,this.pageNo=a.pageNo},isEmpty:function(){return 0===this.trees.length},isComplete:function(){return this.trees.length>=this.size},getFirst:function(){return this.trees[0]},getLast:function(){return this.trees[this.trees.length-1]},get:function(a){return this.trees[a]},getPages:function(){return this.trees},getSize:function(){return this.size},getLength:function(){return this.trees.length}},a}(),Fc=function(){function a(a,b){Dc.call(this,a),this.groupSize=b}return g.extend(a,Dc),a.prototype.getAnchorPageNo=function(a){var b=Dc.prototype.getAnchorPageNo.call(this,a);return this.getGroupPageNo(b)},a.prototype.getGroupPageNo=function(a){return Math.round(a/this.groupSize)},a.prototype._yield=function(){for(var a=new Ec(this.groupSize),b=function(b){a.add(b)},c=0;c<this.groupSize&&this.generator.hasNext();c++)b(this.generator.yield());return a.commit(),a},a.prototype._createEvaluator=function(){return new Cc},a}();Nehan.version="4.0.11",r.copy(e,b.env||{}),r.copy(d,b.layout||{}),r.copy(c,b.config||{});var Gc={};return b.test&&(Gc.Class=g,Gc.Utils=k,Gc.MathUtils=l,Gc.Obj=i,Gc.Css=o,Gc.Html=p,Gc.Closure=q,Gc.Args=r,Gc.List=h,Gc.Color=K,Gc.Colors=L,Gc.Flow=T,Gc.InlineFlow=V,Gc.BlockFlow=U,Gc.BoxFlow=_,Gc.BoxFlows=ab,Gc.Edge=gb,Gc.CssParser=t,Gc.Padding=lb,Gc.Margin=mb,Gc.Border=nb,Gc.BorderColor=jb,Gc.BorderRadius=ib,Gc.Radius2d=hb,Gc.BoxEdge=tb,Gc.BoxSize=ub,Gc.BoxSizing=db,Gc.BoxSizings=eb,Gc.UnitSize=j,Gc.BoxChild=vb,Gc.Box=xb,Gc.Selector=A,Gc.SelectorLexer=y,Gc.SelectorAttr=u,Gc.SelectorPseudo=v,Gc.SelectorType=w,Gc.SelectorCombinator=x,Gc.SelectorStateMachine=z,Gc.Tag=D,Gc.Char=F,Gc.Word=G,Gc.Tcy=H,Gc.Ruby=I,Gc.HtmlLexer=zb,Gc.Token=E,Gc.DocumentContext=Ib,Gc.TocContext=Cb,Gc.EvalResult=wc,Gc.PageGroup=Ec,Gc.Partition=ob,Gc.Cardinal=N,Gc.ListStyle=S,Gc.ListStyleType=P,Gc.ListStylePos=Q,Gc.ListStyleImage=R,Gc.OutlineBuffer=Db,Gc.OutlineContext=Eb,Gc.OutlineParser=Fb,Gc.OutlineConverter=Gb,Gc.TokenStream=Lb,Gc.DocumentTagStream=Ob,Gc.HtmlTagStream=Pb,Gc.HeadTagStream=Qb,Gc.ListTagStream=Sb,Gc.DefListTagStream=Tb,Gc.TableTagStream=Rb,Gc.RubyTagStream=Ub,Gc.ElementGenerator=Xb,Gc.BlockTreeGenerator=cc,Gc.InlineTreeGenerator=dc,Gc.ChildBlockTreeGenerator=kc,Gc.ChildInlineTreeGenerator=ec,Gc.BodyBlockTreeGenerator=oc,Gc.ParallelGenerator=rc,Gc.ParaChildGenerator=sc,Gc.HtmlGenerator=Wb,Gc.DocumentGenerator=Vb,Gc.PageEvaluator=xc,Gc.BlockTreeEvaluator=yc,Gc.InlineTreeEvaluator=zc,Gc.PageGroupEvaluator=Cc,Gc.PageStream=Dc,Gc.PageGroupStream=Fc,Gc.Env=e,Gc.Config=c,Gc.Layout=d,Gc.Style=f,Gc.Selectors=B),Gc.createPageStream=function(a,b){return b=Math.max(1,b||1),1===b?new Dc(a):new Fc(a,b)},Gc.getStyle=function(a){return B.getValue(a)},Gc.setStyle=function(a,b){return B.setValue(a,b),this},Gc.setStyles=function(a){for(var b in a)B.setValue(b,a[b]);return this},Gc};